ฮ
_C:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Auth\Constant.HeaderKey.cs
	namespace 	
Web
 
. 
Api 
. 
Auth 
{ 
public 

class 
	HeaderKey 
{ 
public 
const 
string 
ClientId $
=% &
$str' 1
;1 2
public 
const 
string 
UserId "
=# $
$str% -
;- .
public 
const 
string 
	UserAgent %
=& '
$str( 4
;4 5
public		 
const		 
string		 
ForwardedHeader		 +
=		, -
$str		. ?
;		? @
public 
const 
string 
Authorization )
=* +
$str, ;
;; <
} 
} ป
VC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Auth\ErrorCode.cs
	namespace 	
Web
 
. 
Api 
. 
Auth 
{ 
public 

class 
	ErrorCode 
{ 
public 
const 
string 
NotPermission )
=* +
$str, ;
;; <
} 
} 
dC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Auth\IJwtAuthencationManager.cs
	namespace 	
Web
 
. 
Api 
. 
Auth 
{ 
public 

	interface #
IJwtAuthencationManager ,
{ 
Task		 
<		 
string		 
>		 
Autheticate		  
(		  !
UserRequest		! ,
user		- 1
)		1 2
;		2 3
string

 
GetToken

 
(

 
UserRequest

 #
user

$ (
)

( )
;

) *
} 
} ึ-
cC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Auth\JwtAuthencationManager.cs
	namespace 	
Web
 
. 
Api 
. 
Auth 
{ 
public 

class "
JwtAuthencationManager '
:) *#
IJwtAuthencationManager+ B
{ 
private 
const 
string 
TAG  
=! "
$str# ;
;; <
private 
readonly 
JwtSettings $
_jwtSettings% 1
;1 2
	protected 
readonly 
IUserService '
_userService( 4
;4 5
	protected 
readonly 
ILogger "
<" #"
JwtAuthencationManager# 9
>9 :
_logger; B
;B C
public "
JwtAuthencationManager %
(% &
IUserService& 2
userService3 >
,> ?
ILogger@ G
<G H"
JwtAuthencationManagerH ^
>^ _
logger` f
,f g
IOptionsh p
<p q
JwtSettingsq |
>| }
options	~ 
)
 
{ 	
_jwtSettings 
= 
options "
." #
Value# (
;( )
_userService 
= 
userService &
;& '
_logger 
= 
logger 
; 
} 	
public!! 
async!! 
Task!! 
<!! 
string!!  
>!!  !
Autheticate!!" -
(!!- .
UserRequest!!. 9
userRequest!!: E
)!!E F
{"" 	
try## 
{$$ 
var%% 
users%% 
=%% 
await%% !
_userService%%" .
.%%. /
GetUsersAsync%%/ <
(%%< =
)%%= >
;%%> ?
if&& 
(&& 
!&& 
users&& 
.&& 
Any&& 
(&& 
x&&  
=>&&! #
x&&$ %
.&&% &
	user_name&&& /
==&&0 2
userRequest&&3 >
.&&> ?
	user_name&&? H
&&&&I K
x&&L M
.&&M N
password&&N V
==&&W Y
userRequest&&Z e
.&&e f
password&&f n
)&&n o
)&&o p
{'' 
return(( 
null(( 
;((  
})) 
return** 
GetToken** 
(**  
userRequest**  +
)**+ ,
;**, -
}++ 
catch,, 
(,, 
	Exception,, 
ex,, 
),,  
{-- 
_logger.. 
... 
LogError..  
(..  !
$"..! #
{..# $
TAG..$ '
}..' (
$str..( J
{..J K
ex..K M
...M N
Message..N U
}..U V
"..V W
)..W X
;..X Y
return// 
String// 
.// 
Empty// #
;//# $
}00 
}11 	
public33 
string33 
GetToken33 
(33 
UserRequest33 *
user33+ /
)33/ 0
{44 	
var55 
tokenHandler55 
=55 
new55 "#
JwtSecurityTokenHandler55# :
(55: ;
)55; <
;55< =
var66 
tokenKey66 
=66 
Encoding66 #
.66# $
ASCII66$ )
.66) *
GetBytes66* 2
(662 3
_jwtSettings663 ?
.66? @
Key66@ C
)66C D
;66D E
var88 
tokenDescriptor88 
=88  !
new88" %#
SecurityTokenDescriptor88& =
{99 
Subject:: 
=:: 
new:: 
ClaimsIdentity:: ,
(::, -
new::- 0
Claim::1 6
[::6 7
]::7 8
{;; 
new<< 
Claim<< 
(<< 

ClaimTypes<< (
.<<( )
Name<<) -
,<<- .
user<<. 2
.<<2 3
	user_name<<3 <
)<<< =
,<<= >
new== 
Claim== 
(== 

ClaimTypes== (
.==( )
Role==) -
,==- .
$"==. 0
{==0 1
user==1 5
.==5 6
role==6 :
}==: ;
"==; <
)==< =
}>> 
)>> 
,>> 
Expires?? 
=?? 
DateTime?? "
.??" #
UtcNow??# )
.??) *
AddHours??* 2
(??2 3
_jwtSettings??3 ?
.??? @

ExpireDate??@ J
)??J K
,??K L
SigningCredentials@@ "
=@@# $
new@@% (
SigningCredentials@@) ;
(@@; <
newAA  
SymmetricSecurityKeyAA ,
(AA, -
tokenKeyAA- 5
)AA5 6
,AA6 7
SecurityAlgorithmsBB &
.BB& '
HmacSha256SignatureBB' :
)BB: ;
,BB; <
}CC 
;CC 
varDD 
tokenDD 
=DD 
tokenHandlerDD $
.DD$ %
CreateTokenDD% 0
(DD0 1
tokenDescriptorDD1 @
)DD@ A
;DDA B
returnEE 
tokenHandlerEE 
.EE  

WriteTokenEE  *
(EE* +
tokenEE+ 0
)EE0 1
;EE1 2
}FF 	
privateHH 
JwtSecurityTokenHH  
CreateTokenHH! ,
(HH, -
ListHH- 1
<HH1 2
ClaimHH2 7
>HH7 8

authClaimsHH9 C
)HHC D
{II 	
returnUU 
newUU 
JwtSecurityTokenUU '
(UU' (
)UU( )
;UU) *
}VV 	
}WW 
}XX ฯ
YC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Auth\UserSecurity.cs
	namespace 	
Web
 
. 
Api 
. 
Auth 
{ 
public 

static 
class 
UserSecurity $
{		 
}

 
} ฐ
kC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\Base\BaseAuthController.cs
	namespace

 	
Web


 
.

 
Api

 
.

 
Controllers

 
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str  
)  !
]! "
public 

abstract 
class 
BaseAuthController ,
<, -
T- .
>. /
:0 1
BaseController2 @
<@ A
TA B
>B C
{ 
	protected 
readonly 
AppSettings &
_appSettings' 3
;3 4
	protected 
readonly 
IRoleAccessService -
_roleService. :
;: ;
	protected 
readonly  
IHttpContextAccessor /
_httpContext0 <
;< =
	protected 
readonly 
HttpRequest &
_httpRequest' 3
;3 4
public 
BaseAuthController !
(! "
IServiceProvider" 2
serviceProvider3 B
)B C
:D E
baseF J
(J K
serviceProviderK Z
)Z [
{ 	
_appSettings 
= 
GetRequiredService -
<- .
IOptions. 6
<6 7
AppSettings7 B
>B C
>C D
(D E
)E F
.F G
ValueG L
;L M
_roleService 
= 
GetRequiredService -
<- .
IRoleAccessService. @
>@ A
(A B
)B C
;C D
_httpContext 
= 
GetRequiredService -
<- . 
IHttpContextAccessor. B
>B C
(C D
)D E
;E F
} 	
public"" 
virtual"" 
string"" 
UserId"" $
=>""% '
Request""( /
.""/ 0
Headers""0 7
[""7 8
	HeaderKey""8 A
.""A B
UserId""B H
]""H I
;""I J
public$$ 
virtual$$ 
string$$ 
AccessToken$$ )
{%% 	
get&& 
{'' 
var(( 
authorizationHeader(( '
=((( )
Request((* 1
.((1 2
Headers((2 9
[((9 :
	HeaderKey((: C
.((C D
Authorization((D Q
]((Q R
.((R S
ToString((S [
((([ \
)((\ ]
;((] ^
var)) 
token)) 
=)) 
authorizationHeader)) /
.))/ 0
	Substring))0 9
())9 :
$str)): B
.))B C
Length))C I
)))I J
;))J K
return** 
token** 
;** 
}++ 
},, 	
}-- 
}.. ี 
gC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\Base\BaseController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
public 

class 
BaseController 
<  
T  !
>! "
:# $
ControllerBase% 3
{ 
	protected  
IHttpContextAccessor & 
_httpContextAccessor' ;
;; <
	protected 
readonly 
IServiceProvider +
_serviceProvider, <
;< =
	protected 
readonly 
ILogger "
<" #
T# $
>$ %
_logger& -
;- .
public 
const 
string 
NullIPAddress )
=* +
$str, 1
;1 2
public 
BaseController 
( 
IServiceProvider .
serviceProvider/ >
)> ?
{ 	
_serviceProvider 
= 
serviceProvider .
;. /
_logger 
= 
_serviceProvider &
.& '

GetService' 1
<1 2
ILogger2 9
<9 :
T: ;
>; <
>< =
(= >
)> ?
;? @ 
_httpContextAccessor  
=! "
_serviceProvider# 3
.3 4

GetService4 >
<> ? 
IHttpContextAccessor? S
>S T
(T U
)U V
;V W
} 	
public   
virtual   
S   

GetService   #
<  # $
S  $ %
>  % &
(  & '
)  ' (
{!! 	
return"" 
_serviceProvider"" #
.""# $

GetService""$ .
<"". /
S""/ 0
>""0 1
(""1 2
)""2 3
;""3 4
}## 	
public%% 
virtual%% 
S%% 
GetRequiredService%% +
<%%+ ,
S%%, -
>%%- .
(%%. /
)%%/ 0
{&& 	
return'' 
_serviceProvider'' #
.''# $
GetRequiredService''$ 6
<''6 7
S''7 8
>''8 9
(''9 :
)'': ;
;''; <
}(( 	
public-- 
virtual-- 
string-- 
	UserAgent-- '
=>--( *
Request--+ 2
.--2 3
Headers--3 :
[--: ;
	HeaderKey--; D
.--D E
	UserAgent--E N
]--N O
.--O P
ToString--P X
(--X Y
)--Y Z
;--Z [
public// 
virtual// 
string// 
ClientId// &
=>//' )
Request//* 1
.//1 2
Headers//2 9
[//9 :
	HeaderKey//: C
.//C D
ClientId//D L
]//L M
.//M N
ToString//N V
(//V W
)//W X
;//X Y
	protectedmm 
virtualmm 
boolmm 
IsRequestAvailablemm 1
(mm1 2
)mm2 3
{nn 	
ifoo 
(oo  
_httpContextAccessoroo $
==oo% '
nulloo( ,
||oo- / 
_httpContextAccessoroo0 D
.ooD E
HttpContextooE P
==ooQ S
nullooT X
)ooX Y
returnooZ `
falseooa f
;oof g
trypp 
{qq 
ifrr 
(rr  
_httpContextAccessorrr '
.rr' (
HttpContextrr( 3
.rr3 4
Requestrr4 ;
==rr< >
nullrr? C
)rrC D
returnrrE K
falserrL Q
;rrQ R
}ss 
catchtt 
(tt 
	Exceptiontt 
extt 
)tt  
{uu 
_loggervv 
.vv 
LogErrorvv  
(vv  !
exvv! #
.vv# $
Messagevv$ +
)vv+ ,
;vv, -
returnww 
falseww 
;ww 
}xx 
returnyy 
trueyy 
;yy 
}zz 	
}{{ 
}|| นี
nC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\BlogEnpoint\BlogController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
. 
BlogEnpoint )
{ 
[ 
	Authorize 
] 
public 

class 
BlogController 
:  !
BaseAuthController" 4
<4 5
BlogController5 C
>C D
{ 
private 
const 
string 
TAG  
=! "
$str# 3
;3 4
private 
readonly 
IBlogService %
_blogService& 2
;2 3
public 
BlogController 
( 
IServiceProvider .
serviceProvider/ >
)> ?
:@ A
baseB F
(F G
serviceProviderG V
)V W
{ 	
_blogService 
= 
GetRequiredService -
<- .
IBlogService. :
>: ;
(; <
)< =
;= >
} 	
["" 	
AllowAnonymous""	 
]"" 
[## 	
HttpGet##	 
(## 
$str## 
)## 
]## 
public$$ 
async$$ 
Task$$ 
<$$ 
ServiceResult$$ '
<$$' (
IEnumerable$$( 3
<$$3 4
BlogCategory$$4 @
>$$@ A
>$$A B
>$$B C"
GetBlogCategoriesAsync$$D Z
($$Z [
)$$[ \
{%% 	
var&& 
	svcResult&& 
=&& 
new&& 
ServiceResult&&  -
<&&- .
IEnumerable&&. 9
<&&9 :
BlogCategory&&: F
>&&F G
>&&G H
(&&H I
)&&I J
;&&J K
try'' 
{(( 
var** 
blogCategories** "
=**# $
await**% *
_blogService**+ 7
.**7 8"
GetBlogCategoriesAsync**8 N
(**N O
)**O P
;**P Q
	svcResult++ 
=++ 
new++ 
ServiceResult++  -
<++- .
IEnumerable++. 9
<++9 :
BlogCategory++: F
>++F G
>++G H
{,, 
Data-- 
=-- 
blogCategories-- )
,--) *
Status.. 
=.. 
ServiceResultStatus.. 0
...0 1
Ok..1 3
,..3 4
Success// 
=// 
true// "
}00 
;00 
return11 
	svcResult11  
;11  !
}22 
catch33 
(33 
	Exception33 
ex33 
)33  
{44 
_logger55 
.55 
LogError55  
(55  !
$"55! #
{55# $
TAG55$ '
}55' (
$str55( U
{55U V
ex55V X
.55X Y
Message55Y `
}55` a
"55a b
)55b c
;55c d
	svcResult66 
.66 
Message66 !
=66" #
$"66$ &
{66& '
ex66' )
.66) *
Message66* 1
}661 2
"662 3
;663 4
	svcResult77 
.77 
Status77  
=77! "
ServiceResultStatus77# 6
.776 7
ServerError777 B
;77B C
return88 
	svcResult88  
;88  !
}99 
}:: 	
[AA 	
AllowAnonymousAA	 
]AA 
[BB 	
HttpPostBB	 
(BB 
$strBB $
)BB$ %
]BB% &
publicCC 
asyncCC 
TaskCC 
<CC 
ServiceResultCC '
<CC' (
PaggingCC( /
<CC/ 0
BlogCategoryCC0 <
>CC< =
>CC= >
>CC> ?'
GetBlogCategoryPaggingAsyncCC@ [
(CC[ \
[CC\ ]
FromBodyCC] e
]CCe f

PaginationCCg q

paginationCCr |
)CC| }
{DD 	
varEE 
	svcResultEE 
=EE 
newEE 
ServiceResultEE  -
<EE- .
PaggingEE. 5
<EE5 6
BlogCategoryEE6 B
>EEB C
>EEC D
(EED E
)EEE F
;EEF G
tryFF 
{GG 
varHH 

pageResultHH 
=HH  
awaitHH! &
_blogServiceHH' 3
.HH3 4)
GetBlogCategoriesPaggingAsyncHH4 Q
(HHQ R

paginationHHR \
)HH\ ]
;HH] ^
	svcResultII 
=II 
newII 
ServiceResultII  -
<II- .
PaggingII. 5
<II5 6
BlogCategoryII6 B
>IIB C
>IIC D
{JJ 
DataKK 
=KK 

pageResultKK %
,KK% &
StatusLL 
=LL 
ServiceResultStatusLL 0
.LL0 1
OkLL1 3
,LL3 4
SuccessMM 
=MM 
trueMM "
}NN 
;NN 
returnOO 
	svcResultOO  
;OO  !
}PP 
catchQQ 
(QQ 
	ExceptionQQ 
exQQ 
)QQ  
{RR 
_loggerSS 
.SS 
LogErrorSS  
(SS  !
$"SS! #
{SS# $
TAGSS$ '
}SS' (
$strSS( Z
{SSZ [
exSS[ ]
.SS] ^
MessageSS^ e
}SSe f
"SSf g
)SSg h
;SSh i
returnTT 
	svcResultTT  
;TT  !
}UU 
}VV 	
[]] 	
HttpPost]]	 
(]] 
$str]] #
)]]# $
]]]$ %
public^^ 
async^^ 
Task^^ 
<^^ 
ServiceResult^^ '
<^^' (
bool^^( ,
>^^, -
>^^- .#
InsertBlogCategoryAsync^^/ F
(^^F G
[^^G H
FromBody^^H P
]^^P Q
BlogCategory^^R ^
blogCategory^^_ k
)^^k l
{__ 	
var`` 
	svcResult`` 
=`` 
new`` 
ServiceResult``  -
<``- .
bool``. 2
>``2 3
(``3 4
)``4 5
;``5 6
tryaa 
{bb 
varcc 
	resInsertcc 
=cc 
awaitcc  %
_blogServicecc& 2
.cc2 3#
InsertBlogCategoryAsynccc3 J
(ccJ K
blogCategoryccK W
)ccW X
;ccX Y
	svcResultdd 
=dd 
newdd 
ServiceResultdd  -
<dd- .
booldd. 2
>dd2 3
{ee 
Dataff 
=ff 
	resInsertff $
,ff$ %
Statusgg 
=gg 
ServiceResultStatusgg 0
.gg0 1
Okgg1 3
,gg3 4
Successhh 
=hh 
truehh "
}ii 
;ii 
returnjj 
	svcResultjj  
;jj  !
}kk 
catchll 
(ll 
	Exceptionll 
exll 
)ll  
{mm 
_loggernn 
.nn 
LogErrornn  
(nn  !
$"nn! #
{nn# $
TAGnn$ '
}nn' (
$strnn( V
{nnV W
exnnW Y
.nnY Z
MessagennZ a
}nna b
"nnb c
)nnc d
;nnd e
returnoo 
	svcResultoo  
;oo  !
}pp 
}qq 	
[xx 	
HttpPostxx	 
(xx 
$strxx #
)xx# $
]xx$ %
publicyy 
asyncyy 
Taskyy 
<yy 
ServiceResultyy '
<yy' (
DeleteStatusyy( 4
>yy4 5
>yy5 6#
DeleteBlogCategoryAsyncyy7 N
(yyN O
[yyO P
FromBodyyyP X
]yyX Y
BlogCategoryyyZ f
blogCategoryyyg s
)yys t
{zz 	
var{{ 
	svcResult{{ 
={{ 
new{{ 
ServiceResult{{  -
<{{- .
DeleteStatus{{. :
>{{: ;
({{; <
){{< =
;{{= >
try|| 
{}} 
var~~ 
	resDelete~~ 
=~~ 
await~~  %
_blogService~~& 2
.~~2 3#
DeleteBlogCategoryAsync~~3 J
(~~J K
blogCategory~~K W
)~~W X
;~~X Y
	svcResult 
= 
new 
ServiceResult  -
<- .
DeleteStatus. :
>: ;
{
 
Data
 
=
 
	resDelete
 $
,
$ %
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
,
3 4
Success
 
=
 
true
 "
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( V
{
V W
ex
W Y
.
Y Z
Message
Z a
}
a b
"
b c
)
c d
;
d e
return
 
	svcResult
  
;
  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 #
)
# $
]
$ %
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
bool
( ,
>
, -
>
- .%
UpdateBlogCategoryAsync
/ F
(
F G
[
G H
FromBody
H P
]
P Q
BlogCategory
R ^
blogCategory
_ k
)
k l
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
(
3 4
)
4 5
;
5 6
try
 
{
 
var
 
	updateRes
 
=
 
await
  %
_blogService
& 2
.
2 3%
UpdateBlogCategoryAsync
3 J
(
J K
blogCategory
K W
)
W X
;
X Y
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
{
 
Data
 
=
 
	updateRes
 $
,
$ %
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
,
3 4
Success
 
=
 
true
 "
}
 
;
 
return
 
	svcResult
  
;
  !
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
ex
ขข 
)
ขข  
{
ฃฃ 
_logger
คค 
.
คค 
LogError
คค  
(
คค  !
$"
คค! #
{
คค# $
TAG
คค$ '
}
คค' (
$str
คค( V
{
คคV W
ex
คคW Y
.
คคY Z
Message
คคZ a
}
คคa b
"
คคb c
)
คคc d
;
คคd e
return
ฅฅ 
	svcResult
ฅฅ  
;
ฅฅ  !
}
ฆฆ 
}
งง 	
[
ญญ 	
AllowAnonymous
ญญ	 
]
ญญ 
[
ฎฎ 	
HttpGet
ฎฎ	 
(
ฎฎ 
$str
ฎฎ ,
)
ฎฎ, -
]
ฎฎ- .
public
ฏฏ 
async
ฏฏ 
Task
ฏฏ 
<
ฏฏ 
ServiceResult
ฏฏ '
<
ฏฏ' (
BlogCategory
ฏฏ( 4
>
ฏฏ4 5
>
ฏฏ5 6"
GetBlogCategoryAsync
ฏฏ7 K
(
ฏฏK L
string
ฏฏL R
blogCategoryId
ฏฏS a
)
ฏฏa b
{
ฐฐ 	
var
ฑฑ 
	svcResult
ฑฑ 
=
ฑฑ 
new
ฑฑ 
ServiceResult
ฑฑ  -
<
ฑฑ- .
BlogCategory
ฑฑ. :
>
ฑฑ: ;
(
ฑฑ; <
)
ฑฑ< =
;
ฑฑ= >
try
ฒฒ 
{
ณณ 
var
ดด 
blog
ดด 
=
ดด 
await
ดด  
_blogService
ดด! -
.
ดด- ."
GetBlogCategoryAsync
ดด. B
(
ดดB C
blogCategoryId
ดดC Q
)
ดดQ R
;
ดดR S
	svcResult
ตต 
=
ตต 
new
ตต 
ServiceResult
ตต  -
<
ตต- .
BlogCategory
ตต. :
>
ตต: ;
{
ถถ 
Data
ทท 
=
ทท 
blog
ทท 
,
ทท  
Status
ธธ 
=
ธธ !
ServiceResultStatus
ธธ 0
.
ธธ0 1
Ok
ธธ1 3
,
ธธ3 4
Success
นน 
=
นน 
true
นน "
}
บบ 
;
บบ 
return
ปป 
	svcResult
ปป  
;
ปป  !
}
ผผ 
catch
ฝฝ 
(
ฝฝ 
	Exception
ฝฝ 
ex
ฝฝ 
)
ฝฝ  
{
พพ 
_logger
ฟฟ 
.
ฟฟ 
LogError
ฟฟ  
(
ฟฟ  !
$"
ฟฟ! #
{
ฟฟ# $
TAG
ฟฟ$ '
}
ฟฟ' (
$str
ฟฟ( S
{
ฟฟS T
ex
ฟฟT V
.
ฟฟV W
Message
ฟฟW ^
}
ฟฟ^ _
"
ฟฟ_ `
)
ฟฟ` a
;
ฟฟa b
return
ภภ 
	svcResult
ภภ  
;
ภภ  !
}
มม 
}
ยย 	
[
สส 	
AllowAnonymous
สส	 
]
สส 
[
หห 	
HttpGet
หห	 
]
หห 
public
ฬฬ 
async
ฬฬ 
Task
ฬฬ 
<
ฬฬ 
IEnumerable
ฬฬ %
<
ฬฬ% &
Blog
ฬฬ& *
>
ฬฬ* +
>
ฬฬ+ ,
GetBlogsAsync
ฬฬ- :
(
ฬฬ: ;
)
ฬฬ; <
{
ออ 	
try
ฮฮ 
{
ฯฯ 
var
ัั 
blogs
ัั 
=
ัั 
await
ัั !
_blogService
ัั" .
.
ัั. /
GetBlogsAsync
ัั/ <
(
ัั< =
)
ัั= >
;
ัั> ?
return
าา 
blogs
าา 
;
าา 
}
ำำ 
catch
ิิ 
(
ิิ 
	Exception
ิิ 
ex
ิิ 
)
ิิ  
{
ีี 
_logger
ึึ 
.
ึึ 
LogError
ึึ  
(
ึึ  !
$"
ึึ! #
{
ึึ# $
TAG
ึึ$ '
}
ึึ' (
$str
ึึ( L
{
ึึL M
ex
ึึM O
.
ึึO P
Message
ึึP W
}
ึึW X
"
ึึX Y
)
ึึY Z
;
ึึZ [
return
ืื 
null
ืื 
;
ืื 
}
ุุ 
}
ูู 	
[
฿฿ 	
AllowAnonymous
฿฿	 
]
฿฿ 
[
เเ 	
HttpGet
เเ	 
(
เเ 
$str
เเ 
)
เเ 
]
เเ 
public
แแ 
async
แแ 
Task
แแ 
<
แแ 
ServiceResult
แแ '
<
แแ' (
BlogRespone
แแ( 3
>
แแ3 4
>
แแ4 5
GetBlogAsync
แแ6 B
(
แแB C
string
แแC I
blogId
แแJ P
)
แแP Q
{
โโ 	
var
ใใ 
	svcResult
ใใ 
=
ใใ 
new
ใใ 
ServiceResult
ใใ  -
<
ใใ- .
BlogRespone
ใใ. 9
>
ใใ9 :
(
ใใ: ;
)
ใใ; <
;
ใใ< =
try
ไไ 
{
ๅๅ 
var
ๆๆ 
blog
ๆๆ 
=
ๆๆ 
await
ๆๆ  
_blogService
ๆๆ! -
.
ๆๆ- .
GetBlogAsync
ๆๆ. :
(
ๆๆ: ;
blogId
ๆๆ; A
)
ๆๆA B
;
ๆๆB C
	svcResult
็็ 
=
็็ 
new
็็ 
ServiceResult
็็  -
<
็็- .
BlogRespone
็็. 9
>
็็9 :
{
่่ 
Data
้้ 
=
้้ 
blog
้้ 
,
้้  
Status
๊๊ 
=
๊๊ !
ServiceResultStatus
๊๊ 0
.
๊๊0 1
Ok
๊๊1 3
,
๊๊3 4
Success
๋๋ 
=
๋๋ 
true
๋๋ "
}
์์ 
;
์์ 
return
ํํ 
	svcResult
ํํ  
;
ํํ  !
}
๎๎ 
catch
๏๏ 
(
๏๏ 
	Exception
๏๏ 
ex
๏๏ 
)
๏๏  
{
๐๐ 
_logger
๑๑ 
.
๑๑ 
LogError
๑๑  
(
๑๑  !
$"
๑๑! #
{
๑๑# $
TAG
๑๑$ '
}
๑๑' (
$str
๑๑( K
{
๑๑K L
ex
๑๑L N
.
๑๑N O
Message
๑๑O V
}
๑๑V W
"
๑๑W X
)
๑๑X Y
;
๑๑Y Z
return
๒๒ 
	svcResult
๒๒  
;
๒๒  !
}
๓๓ 
}
๔๔ 	
[
๖๖ 	
AllowAnonymous
๖๖	 
]
๖๖ 
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
Pagging
( /
<
/ 0
BlogRespone
0 ;
>
; <
>
< =
>
= >!
GetBlogPaggingAsync
? R
(
R S
[
S T
FromBody
T \
]
\ ]

Pagination
^ h

pagination
i s
)
s t
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
Pagging
. 5
<
5 6
BlogRespone
6 A
>
A B
>
B C
(
C D
)
D E
;
E F
try
 
{
 
var
 

pageResult
 
=
  
await
! &
_blogService
' 3
.
3 4"
GetBlogsPaggingAsync
4 H
(
H I

pagination
I S
)
S T
;
T U
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
Pagging
. 5
<
5 6
BlogRespone
6 A
>
A B
>
B C
{
 
Data
 
=
 

pageResult
 %
,
% &
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( R
{
R S
ex
S U
.
U V
Message
V ]
}
] ^
"
^ _
)
_ `
;
` a
return
 
	svcResult
  
;
  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
bool
( ,
>
, -
>
- .
InsertBlogAsync
/ >
(
> ?
[
? @
FromBody
@ H
]
H I
BlogRequest
J U
blog
V Z
)
Z [
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
(
3 4
)
4 5
;
5 6
try
 
{
 
var
 
	resInsert
 
=
 
await
  %
_blogService
& 2
.
2 3
InsertBlogAsync
3 B
(
B C
blog
C G
)
G H
;
H I
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
{
 
Data
 
=
 
	resInsert
 $
,
$ %
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
,
3 4
Success
 
=
 
true
 "
}
 
;
 
return
กก 
	svcResult
กก  
;
กก  !
}
ขข 
catch
ฃฃ 
(
ฃฃ 
	Exception
ฃฃ 
ex
ฃฃ 
)
ฃฃ  
{
คค 
_logger
ฅฅ 
.
ฅฅ 
LogError
ฅฅ  
(
ฅฅ  !
$"
ฅฅ! #
{
ฅฅ# $
TAG
ฅฅ$ '
}
ฅฅ' (
$str
ฅฅ( N
{
ฅฅN O
ex
ฅฅO Q
.
ฅฅQ R
Message
ฅฅR Y
}
ฅฅY Z
"
ฅฅZ [
)
ฅฅ[ \
;
ฅฅ\ ]
return
ฆฆ 
	svcResult
ฆฆ  
;
ฆฆ  !
}
งง 
}
จจ 	
[
ซซ 	
HttpPost
ซซ	 
(
ซซ 
$str
ซซ 
)
ซซ 
]
ซซ 
public
ฌฌ 
async
ฌฌ 
Task
ฌฌ 
<
ฌฌ 
ServiceResult
ฌฌ '
<
ฌฌ' (
bool
ฌฌ( ,
>
ฌฌ, -
>
ฌฌ- .
DeleteBlogAsync
ฌฌ/ >
(
ฌฌ> ?
[
ฌฌ? @
FromBody
ฌฌ@ H
]
ฌฌH I
Blog
ฌฌJ N
blog
ฌฌO S
)
ฌฌS T
{
ญญ 	
var
ฎฎ 
	svcResult
ฎฎ 
=
ฎฎ 
new
ฎฎ 
ServiceResult
ฎฎ  -
<
ฎฎ- .
bool
ฎฎ. 2
>
ฎฎ2 3
(
ฎฎ3 4
)
ฎฎ4 5
;
ฎฎ5 6
try
ฏฏ 
{
ฐฐ 
var
ฑฑ 
	resDelete
ฑฑ 
=
ฑฑ 
await
ฑฑ  %
_blogService
ฑฑ& 2
.
ฑฑ2 3
DeleteBlogAsync
ฑฑ3 B
(
ฑฑB C
blog
ฑฑC G
)
ฑฑG H
;
ฑฑH I
	svcResult
ฒฒ 
=
ฒฒ 
new
ฒฒ 
ServiceResult
ฒฒ  -
<
ฒฒ- .
bool
ฒฒ. 2
>
ฒฒ2 3
{
ณณ 
Data
ดด 
=
ดด 
	resDelete
ดด $
,
ดด$ %
Status
ตต 
=
ตต !
ServiceResultStatus
ตต 0
.
ตต0 1
Ok
ตต1 3
,
ตต3 4
Success
ถถ 
=
ถถ 
true
ถถ "
}
ทท 
;
ทท 
return
ธธ 
	svcResult
ธธ  
;
ธธ  !
}
นน 
catch
บบ 
(
บบ 
	Exception
บบ 
ex
บบ 
)
บบ  
{
ปป 
_logger
ผผ 
.
ผผ 
LogError
ผผ  
(
ผผ  !
$"
ผผ! #
{
ผผ# $
TAG
ผผ$ '
}
ผผ' (
$str
ผผ( N
{
ผผN O
ex
ผผO Q
.
ผผQ R
Message
ผผR Y
}
ผผY Z
"
ผผZ [
)
ผผ[ \
;
ผผ\ ]
return
ฝฝ 
	svcResult
ฝฝ  
;
ฝฝ  !
}
พพ 
}
ฟฟ 	
[
มม 	
HttpPost
มม	 
(
มม 
$str
มม 
)
มม  
]
มม  !
public
ยย 
async
ยย 
Task
ยย 
<
ยย 
ServiceResult
ยย '
<
ยย' (
bool
ยย( ,
>
ยย, -
>
ยย- .
DeleteBlogsAsync
ยย/ ?
(
ยย? @
[
ยย@ A
FromBody
ยยA I
]
ยยI J
List
ยยK O
<
ยยO P
Blog
ยยP T
>
ยยT U
blogs
ยยV [
)
ยย[ \
{
รร 	
var
ฤฤ 
	svcResult
ฤฤ 
=
ฤฤ 
new
ฤฤ 
ServiceResult
ฤฤ  -
<
ฤฤ- .
bool
ฤฤ. 2
>
ฤฤ2 3
(
ฤฤ3 4
)
ฤฤ4 5
;
ฤฤ5 6
try
ลล 
{
ฦฦ 
var
วว 
	resDelete
วว 
=
วว 
await
วว  %
_blogService
วว& 2
.
วว2 3
DeleteBlogsAsync
วว3 C
(
ววC D
blogs
ววD I
)
ววI J
;
ววJ K
	svcResult
ศศ 
=
ศศ 
new
ศศ 
ServiceResult
ศศ  -
<
ศศ- .
bool
ศศ. 2
>
ศศ2 3
{
ษษ 
Data
สส 
=
สส 
	resDelete
สส $
,
สส$ %
Status
หห 
=
หห !
ServiceResultStatus
หห 0
.
หห0 1
Ok
หห1 3
,
หห3 4
Success
ฬฬ 
=
ฬฬ 
true
ฬฬ "
}
ออ 
;
ออ 
return
ฮฮ 
	svcResult
ฮฮ  
;
ฮฮ  !
}
ฯฯ 
catch
ะะ 
(
ะะ 
	Exception
ะะ 
ex
ะะ 
)
ะะ  
{
ัั 
_logger
าา 
.
าา 
LogError
าา  
(
าา  !
$"
าา! #
{
าา# $
TAG
าา$ '
}
าา' (
$str
าา( O
{
าาO P
ex
าาP R
.
าาR S
Message
าาS Z
}
าาZ [
"
าา[ \
)
าา\ ]
;
าา] ^
return
ำำ 
	svcResult
ำำ  
;
ำำ  !
}
ิิ 
}
ีี 	
[
ืื 	
HttpPost
ืื	 
(
ืื 
$str
ืื 
)
ืื 
]
ืื 
public
ุุ 
async
ุุ 
Task
ุุ 
<
ุุ 
ServiceResult
ุุ '
<
ุุ' (
bool
ุุ( ,
>
ุุ, -
>
ุุ- .
UpdateBlogAsync
ุุ/ >
(
ุุ> ?
[
ุุ? @
FromBody
ุุ@ H
]
ุุH I
BlogRequest
ุุJ U
blog
ุุV Z
)
ุุZ [
{
ูู 	
var
ฺฺ 
	svcResult
ฺฺ 
=
ฺฺ 
new
ฺฺ 
ServiceResult
ฺฺ  -
<
ฺฺ- .
bool
ฺฺ. 2
>
ฺฺ2 3
(
ฺฺ3 4
)
ฺฺ4 5
;
ฺฺ5 6
try
 
{
 
var
 
	updateRes
 
=
 
await
  %
_blogService
& 2
.
2 3
UpdateBlogAsync
3 B
(
B C
blog
C G
)
G H
;
H I
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
{
฿฿ 
Data
เเ 
=
เเ 
	updateRes
เเ $
,
เเ$ %
Status
แแ 
=
แแ !
ServiceResultStatus
แแ 0
.
แแ0 1
Ok
แแ1 3
,
แแ3 4
Success
โโ 
=
โโ 
true
โโ "
}
ใใ 
;
ใใ 
return
ไไ 
	svcResult
ไไ  
;
ไไ  !
}
ๅๅ 
catch
ๆๆ 
(
ๆๆ 
	Exception
ๆๆ 
ex
ๆๆ 
)
ๆๆ  
{
็็ 
_logger
่่ 
.
่่ 
LogError
่่  
(
่่  !
$"
่่! #
{
่่# $
TAG
่่$ '
}
่่' (
$str
่่( N
{
่่N O
ex
่่O Q
.
่่Q R
Message
่่R Y
}
่่Y Z
"
่่Z [
)
่่[ \
;
่่\ ]
return
้้ 
	svcResult
้้  
;
้้  !
}
๊๊ 
}
๋๋ 	
}
ํํ 
}๎๎ ๚
nC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\CartEnpoint\CartController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
. 
CartEnpoint )
{ 
public 

class 
CartController 
:  !
BaseAuthController" 4
<4 5
CartController5 C
>C D
{ 
private 
const 
string 
TAG  
=! "
$str# 6
;6 7
private 
readonly 
ICartService %
_cartService& 2
;2 3
public 
CartController 
( 
IServiceProvider .
serviceProvider/ >
)> ?
:@ A
baseB F
(F G
serviceProviderG V
)V W
{ 	
_cartService 
= 
GetRequiredService -
<- .
ICartService. :
>: ;
(; <
)< =
;= >
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ServiceResult '
<' (
Pagging( /
</ 0
Cart0 4
>4 5
>5 6
>6 7
GetCartsAsync8 E
(E F
stringF L
userIdM S
)S T
{ 	
try 
{ 
var 
cartPage 
= 
new "
ServiceResult# 0
<0 1
Pagging1 8
<8 9
Cart9 =
>= >
>> ?
(? @
)@ A
;A B
return 
cartPage 
;  
} 
catch 
( 
	Exception 
ex 
)  
{   
_logger!! 
.!! 
LogError!!  
(!!  !
ex!!! #
,!!# $
$"!!% '
{!!' (
TAG!!( +
}!!+ ,
$str!!, K
{!!K L
ex!!L N
.!!N O
Message!!O V
}!!V W
"!!W X
)!!X Y
;!!Y Z
return"" 
null"" 
;"" 
}## 
}$$ 	
}'' 
}(( x
vC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\CustomerEnpoint\CustomerController.csฤ
kC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\Download\DowloadRequest.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
public 

class 
DowloadRequest 
{ 
public 
byte 
[ 
] 
data 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
FileName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 

Base64File  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} ฤ	
oC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\Download\DownloadController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
[ 
ApiController 
] 
[		 
Route		 

(		
 
$str		  
)		  !
]		! "
public

 

class

 
DownloadController

 #
:

$ %

Controller

& 0
{ 
private 
readonly 
IDownloadService )
_downloadService* :
;: ;
private 
readonly 
IImportExcelService ,
_importExcelService- @
;@ A
public 
DownloadController !
(! "
IDownloadService" 2
downloadService3 B
,B C
IImportExcelServiceD W
importExcelServiceX j
)j k
{ 	
_downloadService 
= 
downloadService .
;. /
_importExcelService 
=  !
importExcelService" 4
;4 5
} 	
}.. 
}// ฉ
oC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\EmailEnpoint\MailController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
public		 

class		 
EmailController		  
:		! "
BaseAuthController		# 5
<		5 6
EmailController		6 E
>		E F
{

 
private 
const 
string 
TAG  
=! "
$str# 3
;3 4
	protected 
ISendMailClient !
_mailClient" -
;- .
public 
EmailController 
( 
ISendMailClient .

mailClient/ 9
,9 :
IServiceProvider; K
serviceProviderL [
)[ \
:] ^
base_ c
(c d
serviceProviderd s
)s t
{ 	
_mailClient 
= 

mailClient $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
bool 
> 
SendEmailAsync  .
(. /
[/ 0
FromBody0 8
]8 9
MailContent: E
mailContentF Q
)Q R
{ 	
try 
{ 
await 
_mailClient !
.! "
SendMailAsync" /
(/ 0
mailContent0 ;
); <
;< =
return 
true 
; 
} 
catch 
( 
	Exception 
ex 
)  
{ 
_logger   
.   
LogError    
(    !
$"  ! #
{  # $
TAG  $ '
}  ' (
$str  ( M
{  M N
ex  N P
.  P Q
Message  Q X
}  X Y
"  Y Z
)  Z [
;  [ \
return!! 
false!! 
;!! 
}"" 
}## 	
[&& 	
HttpGet&&	 
(&& 
$str&& 
)&& 
]&& 
public'' 
async'' 
Task'' 
<'' 
bool'' 
>'' 
SendEmailAsync''  .
(''. /
[''/ 0
	FromQuery''0 9
]''9 :
string''; A
to''B D
,''D E
[''F G
	FromQuery''G P
]''P Q
string''R X
subject''Y `
,''` a
[''b c
	FromQuery''c l
]''l m
string''n t
body''u y
)''y z
{(( 	
try)) 
{** 
await++ 
_mailClient++ !
.++! "
SendMailAsync++" /
(++/ 0
to++0 2
,++2 3
subject++3 :
,++: ;
body++; ?
)++? @
;++@ A
return,, 
true,, 
;,, 
}-- 
catch.. 
(.. 
	Exception.. 
ex.. 
)..  
{// 
_logger00 
.00 
LogError00  
(00  !
$"00! #
{00# $
TAG00$ '
}00' (
$str00( M
{00M N
ex00N P
.00P Q
Message00Q X
}00X Y
"00Y Z
)00Z [
;00[ \
return11 
false11 
;11 
}22 
}33 	
}55 
}66 P
lC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\GHNEnpoint\GHNController.cs
	namespace

 	
Web


 
.

 
Api

 
.

 
Controllers

 
.

 

GHNEnpoint

 (
{ 
public 

class 
GHNController 
:  
BaseAuthController! 3
<3 4
GHNController4 A
>A B
{ 
private 
const 
string 
TAG  
=! "
$str# 2
;2 3
	protected 
readonly 

IGHNClient %
_ghn& *
;* +
public 
GHNController 
( 
IServiceProvider -
serviceProvider. =
)= >
:? @
baseA E
(E F
serviceProviderF U
)U V
{ 	
_ghn 
= 
GetRequiredService %
<% &

IGHNClient& 0
>0 1
(1 2
)2 3
;3 4
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public   
async   
Task   
<   
ServiceResult   '
<  ' (
List  ( ,
<  , -
Province  - 5
>  5 6
>  6 7
>  7 8
GetProvincesAsync  9 J
(  J K
)  K L
{!! 	
var"" 
	svcResult"" 
="" 
new"" 
ServiceResult""  -
<""- .
List"". 2
<""2 3
Province""3 ;
>""; <
>""< =
(""= >
)""> ?
;""? @
try## 
{$$ 
var%% 
	provinces%% 
=%% 
await%%  %
_ghn%%& *
.%%* +
GetProvinces%%+ 7
(%%7 8
)%%8 9
;%%9 :
if&& 
(&& 
	provinces&& 
!=&&  
null&&! %
)&&% &
{'' 
	svcResult(( 
.(( 
Data(( "
=((# $
	provinces((% .
;((. /
	svcResult)) 
.)) 
Success)) %
=))& '
true))( ,
;)), -
}** 
}++ 
catch,, 
(,, 
	Exception,, 
),, 
{-- 
}.. 
return// 
	svcResult// 
;// 
}00 	
[66 	
HttpGet66	 
(66 
$str66 
)66 
]66 
public77 
async77 
Task77 
<77 
ServiceResult77 '
<77' (
List77( ,
<77, -
District77- 5
>775 6
>776 7
>777 8
GetDistrictsAsync779 J
(77J K
)77K L
{88 	
var99 
	svcResult99 
=99 
new99 
ServiceResult99  -
<99- .
List99. 2
<992 3
District993 ;
>99; <
>99< =
(99= >
)99> ?
;99? @
try:: 
{;; 
var<< 
	districts<< 
=<< 
await<<  %
_ghn<<& *
.<<* +
GetDistricts<<+ 7
(<<7 8
)<<8 9
;<<9 :
if== 
(== 
	districts== 
!===  
null==! %
)==% &
{>> 
	svcResult?? 
.?? 
Data?? "
=??# $
	districts??% .
;??. /
	svcResult@@ 
.@@ 
Success@@ %
=@@& '
true@@( ,
;@@, -
}AA 
}BB 
catchCC 
(CC 
	ExceptionCC 
)CC 
{DD 
}EE 
returnFF 
	svcResultFF 
;FF 
}GG 	
[NN 	
HttpGetNN	 
(NN 
$strNN (
)NN( )
]NN) *
publicOO 
asyncOO 
TaskOO 
<OO 
ServiceResultOO '
<OO' (
ListOO( ,
<OO, -
DistrictOO- 5
>OO5 6
>OO6 7
>OO7 8
GetDistrictsAsyncOO9 J
(OOJ K
intOOK N

provinceIdOOO Y
)OOY Z
{PP 	
varQQ 
	svcResultQQ 
=QQ 
newQQ 
ServiceResultQQ  -
<QQ- .
ListQQ. 2
<QQ2 3
DistrictQQ3 ;
>QQ; <
>QQ< =
(QQ= >
)QQ> ?
;QQ? @
tryRR 
{SS 
varTT 
	districtsTT 
=TT 
awaitTT  %
_ghnTT& *
.TT* +
GetDistrictsTT+ 7
(TT7 8

provinceIdTT8 B
)TTB C
;TTC D
ifUU 
(UU 
	districtsUU 
!=UU  
nullUU! %
)UU% &
{VV 
	svcResultWW 
.WW 
DataWW "
=WW# $
	districtsWW% .
;WW. /
	svcResultXX 
.XX 
SuccessXX %
=XX& '
trueXX( ,
;XX, -
}YY 
}ZZ 
catch[[ 
([[ 
	Exception[[ 
)[[ 
{\\ 
}]] 
return^^ 
	svcResult^^ 
;^^ 
}__ 	
[ff 	
HttpGetff	 
(ff 
$strff $
)ff$ %
]ff% &
publicgg 
asyncgg 
Taskgg 
<gg 
ServiceResultgg '
<gg' (
Listgg( ,
<gg, -
Wardgg- 1
>gg1 2
>gg2 3
>gg3 4
GetWardsAsyncgg5 B
(ggB C
intggC F

districtIdggG Q
)ggQ R
{hh 	
varii 
	svcResultii 
=ii 
newii 
ServiceResultii  -
<ii- .
Listii. 2
<ii2 3
Wardii3 7
>ii7 8
>ii8 9
(ii9 :
)ii: ;
;ii; <
tryjj 
{kk 
varll 
	districtsll 
=ll 
awaitll  %
_ghnll& *
.ll* +
GetWardsll+ 3
(ll3 4

districtIdll4 >
)ll> ?
;ll? @
ifmm 
(mm 
	districtsmm 
!=mm  
nullmm! %
)mm% &
{nn 
	svcResultoo 
.oo 
Dataoo "
=oo# $
	districtsoo% .
;oo. /
	svcResultpp 
.pp 
Successpp %
=pp& '
truepp( ,
;pp, -
}qq 
}rr 
catchss 
(ss 
	Exceptionss 
)ss 
{tt 
}uu 
returnvv 
	svcResultvv 
;vv 
}ww 	
[~~ 	
HttpPost~~	 
(~~ 
$str~~ !
)~~! "
]~~" #
public 
async 
Task 
< 
ServiceResult '
<' (
FeeInfo( /
>/ 0
>0 1
GetFeeOrderAsync2 B
(B C
[C D
FromBodyD L
]L M
FeeInfoRequestN \
request] d
)d e
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
FeeInfo
. 5
>
5 6
(
6 7
)
7 8
;
8 9
try
 
{
 
var
 
feeInfo
 
=
 
await
 #
_ghn
$ (
.
( )
GetFeeInfoAsync
) 8
(
8 9
request
9 @
)
@ A
;
A B
if
 
(
 
feeInfo
 
!=
 
null
 #
)
# $
{
 
	svcResult
 
.
 
Data
 "
=
# $
feeInfo
% ,
;
, -
	svcResult
 
.
 
Success
 %
=
& '
true
( ,
;
, -
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
}
 
return
 
	svcResult
 
;
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 &
)
& '
]
' (
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
LeadTimeInfo
( 4
>
4 5
>
5 6#
GetLeadTimeOrderAsync
7 L
(
L M
[
M N
FromBody
N V
]
V W"
LeadTimeOrderRequest
X l
request
m t
)
t u
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
LeadTimeInfo
. :
>
: ;
(
; <
)
< =
;
= >
try
 
{
 
var
 
feeInfo
 
=
 
await
 #
_ghn
$ (
.
( )#
GetLeadTimeOrderAsync
) >
(
> ?
request
? F
)
F G
;
G H
if
 
(
 
feeInfo
 
!=
 
null
 #
)
# $
{
 
	svcResult
 
.
 
Data
 "
=
# $
feeInfo
% ,
;
, -
	svcResult
 
.
 
Success
 %
=
& '
true
( ,
;
, -
}
กก 
}
ขข 
catch
ฃฃ 
(
ฃฃ 
	Exception
ฃฃ 
ex
ฃฃ 
)
ฃฃ  
{
คค 
_logger
ฅฅ 
.
ฅฅ 
LogError
ฅฅ  
(
ฅฅ  !
ex
ฅฅ! #
,
ฅฅ# $
$"
ฅฅ% '
{
ฅฅ' (
TAG
ฅฅ( +
}
ฅฅ+ ,
$str
ฅฅ, T
{
ฅฅT U
ex
ฅฅU W
.
ฅฅW X
Message
ฅฅX _
}
ฅฅ_ `
"
ฅฅ` a
)
ฅฅa b
;
ฅฅb c
}
ฆฆ 
return
งง 
	svcResult
งง 
;
งง 
}
จจ 	
}
ฉฉ 
}ชช ฉ
nC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\MomoEnpoint\MomoController.cs
	namespace		 	
Web		
 
.		 
Api		 
.		 
Controllers		 
{

 
public 

class 
MomoController 
:  !
BaseAuthController" 4
<4 5
MomoController5 C
>C D
{ 
private 
const 
string 
TAG  
=! "
$str# 3
;3 4
	protected 
readonly 
IMomoClient &
_momo' ,
;, -
public 
MomoController 
( 
IServiceProvider .
serviceProvider/ >
)> ?
:@ A
baseB F
(F G
serviceProviderG V
)V W
{ 	
_momo 
= 
GetRequiredService &
<& '
IMomoClient' 2
>2 3
(3 4
)4 5
;5 6
} 	
[ 	
HttpPost	 
( 
$str  
)  !
]! "
public 
async 
Task 
< 
bool 
> 
PaymentMomoAsync  0
(0 1
)1 2
{ 	
var 
xxx 
= 
await 
_momo !
.! "
PaymentMomoAsync" 2
(2 3
new3 6
PaymentRequest7 E
(E F
)F G
)G H
;H I
return   
false   
;   
}!! 	
}$$ 
}%% 
pC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\OrderEnpoint\OrderController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class 
OrderController  
:! "
BaseAuthController# 5
<5 6
OrderController6 E
>E F
{ 
private 
const 
string 
TAG  
=! "
$str# 4
;4 5
private 
readonly 
IOrderService &
_orderService' 4
;4 5
private 
readonly 
IOrderItemService *
_orderItemService+ <
;< =
private 
readonly 
IPublisherQueue (

_publisher) 3
;3 4
public 
OrderController 
( 
IServiceProvider /
serviceProvider0 ?
)? @
:A B
baseC G
(G H
serviceProviderH W
)W X
{ 	
_orderService 
= 
serviceProvider +
.+ ,
GetRequiredService, >
<> ?
IOrderService? L
>L M
(M N
)N O
;O P
_orderItemService 
= 
serviceProvider  /
./ 0
GetRequiredService0 B
<B C
IOrderItemServiceC T
>T U
(U V
)V W
;W X

_publisher 
= 
serviceProvider (
.( )
GetRequiredService) ;
<; <
IPublisherQueue< K
>K L
(L M
)M N
;N O
} 	
['' 	
HttpPost''	 
('' 
$str'' 
)'' 
]'' 
public(( 
async(( 
Task(( 
<(( 
ServiceResult(( '
<((' (
bool((( ,
>((, -
>((- .
InsertOrderAsync((/ ?
(((? @
[((@ A
FromBody((A I
]((I J
OrderRequest((K W
order((X ]
)((] ^
{)) 	
var** 
	svcResult** 
=** 
new** 
ServiceResult**  -
<**- .
bool**. 2
>**2 3
(**3 4
)**4 5
;**5 6
try++ 
{,, 
var-- 
res-- 
=-- 
await-- 

_publisher--  *
.--* +#
PublishInsertOrderAsync--+ B
(--B C
order--C H
,--H I
null--J N
)--N O
;--O P
	svcResult.. 
=.. 
new.. 
ServiceResult..  -
<..- .
bool... 2
>..2 3
{// 
Data00 
=00 
res00 
,00 
Success11 
=11 
res11 !
,11! "
Status22 
=22 
ServiceResultStatus22 0
.220 1
Ok221 3
}33 
;33 
return44 
	svcResult44  
;44  !
}55 
catch66 
(66 
	Exception66 
ex66 
)66  
{77 
_logger88 
.88 
LogError88  
(88  !
$"88! #
{88# $
TAG88$ '
}88' (
$str88( O
{88O P
ex88P R
.88R S
Message88S Z
}88Z [
"88[ \
)88\ ]
;88] ^
return99 
	svcResult99  
;99  !
}:: 
};; 	
[CC 	
HttpPostCC	 
(CC 
$strCC 
)CC 
]CC 
publicDD 
asyncDD 
TaskDD 
<DD 
ServiceResultDD '
<DD' (
boolDD( ,
>DD, -
>DD- .
UpdateOrderAsyncDD/ ?
(DD? @
[DD@ A
FromBodyDDA I
]DDI J
OrderDDK P
orderDDQ V
)DDV W
{EE 	
varFF 
	svcResultFF 
=FF 
newFF 
ServiceResultFF  -
<FF- .
boolFF. 2
>FF2 3
(FF3 4
)FF4 5
;FF5 6
tryGG 
{HH 
varII 
resII 
=II 
awaitII 
_orderServiceII  -
.II- .
UpdateOrderAsyncII. >
(II> ?
orderII? D
)IID E
;IIE F
	svcResultJJ 
=JJ 
newJJ 
ServiceResultJJ  -
<JJ- .
boolJJ. 2
>JJ2 3
{KK 
DataLL 
=LL 
resLL 
,LL 
SuccessMM 
=MM 
resMM !
,MM! "
StatusNN 
=NN 
ServiceResultStatusNN 0
.NN0 1
OkNN1 3
}OO 
;OO 
returnPP 
	svcResultPP  
;PP  !
}QQ 
catchRR 
(RR 
	ExceptionRR 
exRR 
)RR  
{SS 
_loggerTT 
.TT 
LogErrorTT  
(TT  !
$"TT! #
{TT# $
TAGTT$ '
}TT' (
$strTT( O
{TTO P
exTTP R
.TTR S
MessageTTS Z
}TTZ [
"TT[ \
)TT\ ]
;TT] ^
returnUU 
	svcResultUU  
;UU  !
}VV 
}WW 	
[__ 	
HttpGet__	 
(__ 
$str__ #
)__# $
]__$ %
public`` 
async`` 
Task`` 
<`` 
ServiceResult`` '
<``' (
bool``( ,
>``, -
>``- .
DeleteOrderAsync``/ ?
(``? @
string``@ F
orderId``G N
)``N O
{aa 	
varbb 
	svcResultbb 
=bb 
newbb 
ServiceResultbb  -
<bb- .
boolbb. 2
>bb2 3
(bb3 4
)bb4 5
;bb5 6
trycc 
{dd 
varee 
	deleteResee 
=ee 
awaitee  %
_orderServiceee& 3
.ee3 4
DeleteOrderAsyncee4 D
(eeD E
orderIdeeE L
)eeL M
;eeM N
	svcResultff 
=ff 
newff 
ServiceResultff  -
<ff- .
boolff. 2
>ff2 3
{gg 
Datahh 
=hh 
	deleteReshh $
,hh$ %
Successii 
=ii 
trueii "
,ii" #
Statusjj 
=jj 
ServiceResultStatusjj 0
.jj0 1
Okjj1 3
}kk 
;kk 
returnmm 
	svcResultmm  
;mm  !
}nn 
catchoo 
(oo 
	Exceptionoo 
exoo 
)oo  
{pp 
_loggerqq 
.qq 
LogErrorqq  
(qq  !
$"qq! #
{qq# $
TAGqq$ '
}qq' (
$strqq( O
{qqO P
exqqP R
.qqR S
MessageqqS Z
}qqZ [
"qq[ \
)qq\ ]
;qq] ^
returnrr 
	svcResultrr  
;rr  !
}ss 
}tt 	
[{{ 	
HttpPost{{	 
({{ 
$str{{ 
){{  
]{{  !
public|| 
async|| 
Task|| 
<|| 
ServiceResult|| '
<||' (
Boolean||( /
>||/ 0
>||0 1
DeleteOrdersAsync||2 C
(||C D
[||D E
FromBody||E M
]||M N
OrderRequest||O [
request||\ c
)||c d
{}} 	
var~~ 
	svcResult~~ 
=~~ 
new~~ 
ServiceResult~~  -
<~~- .
bool~~. 2
>~~2 3
(~~3 4
)~~4 5
;~~5 6
try 
{
 
var
 
	deleteRes
 
=
 
await
  %
_orderService
& 3
.
3 4
DeleteOrdersAsync
4 E
(
E F
request
F M
.
M N
	order_ids
N W
)
W X
;
X Y
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
Boolean
. 5
>
5 6
{
 
Data
 
=
 
	deleteRes
 $
,
$ %
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( P
{
P Q
ex
Q S
.
S T
Message
T [
}
[ \
"
\ ]
)
] ^
;
^ _
return
 
	svcResult
  
;
  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
Pagging
( /
<
/ 0
Order
0 5
>
5 6
>
6 7
>
7 8
GetPageOrderAsync
9 J
(
J K
[
K L
FromBody
L T
]
T U

Pagination
V `

pagination
a k
)
k l
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
Pagging
. 5
<
5 6
Order
6 ;
>
; <
>
< =
(
= >
)
> ?
;
? @
try
 
{
 
var
 
	orderPage
 
=
 
await
  %
_orderService
& 3
.
3 4
GetOrderPageAsync
4 E
(
E F

pagination
F P
)
P Q
;
Q R
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
Pagging
. 5
<
5 6
Order
6 ;
>
; <
>
< =
{
 
Data
 
=
 
	orderPage
 $
,
$ %
Success
 
=
 
true
 "
,
" #
Status
กก 
=
กก !
ServiceResultStatus
กก 0
.
กก0 1
Ok
กก1 3
}
ขข 
;
ขข 
return
ฃฃ 
	svcResult
ฃฃ  
;
ฃฃ  !
}
คค 
catch
ฅฅ 
(
ฅฅ 
	Exception
ฅฅ 
ex
ฅฅ 
)
ฅฅ  
{
ฆฆ 
_logger
งง 
.
งง 
LogError
งง  
(
งง  !
$"
งง! #
{
งง# $
TAG
งง$ '
}
งง' (
$str
งง( P
{
งงP Q
ex
งงQ S
.
งงS T
Message
งงT [
}
งง[ \
"
งง\ ]
)
งง] ^
;
งง^ _
return
จจ 
	svcResult
จจ  
;
จจ  !
}
ฉฉ 
}
ชช 	
[
ฑฑ 	
HttpGet
ฑฑ	 
(
ฑฑ 
$str
ฑฑ 
)
ฑฑ 
]
ฑฑ 
public
ฒฒ 
async
ฒฒ 
Task
ฒฒ 
<
ฒฒ 
ServiceResult
ฒฒ '
<
ฒฒ' (
Order
ฒฒ( -
>
ฒฒ- .
>
ฒฒ. /
GetOrderAsync
ฒฒ0 =
(
ฒฒ= >
string
ฒฒ> D
orderId
ฒฒE L
)
ฒฒL M
{
ณณ 	
var
ดด 
	svcResult
ดด 
=
ดด 
new
ดด 
ServiceResult
ดด  -
<
ดด- .
Order
ดด. 3
>
ดด3 4
(
ดด4 5
)
ดด5 6
;
ดด6 7
try
ตต 
{
ถถ 
var
ทท 
order
ทท 
=
ทท 
await
ทท !
_orderService
ทท" /
.
ทท/ 0
GetOrderAsync
ทท0 =
(
ทท= >
orderId
ทท> E
)
ททE F
;
ททF G
	svcResult
ธธ 
=
ธธ 
new
ธธ 
ServiceResult
ธธ  -
<
ธธ- .
Order
ธธ. 3
>
ธธ3 4
{
นน 
Data
บบ 
=
บบ 
order
บบ  
,
บบ  !
Success
ปป 
=
ปป 
true
ปป "
,
ปป" #
Status
ผผ 
=
ผผ !
ServiceResultStatus
ผผ 0
.
ผผ0 1
Ok
ผผ1 3
}
ฝฝ 
;
ฝฝ 
return
พพ 
	svcResult
พพ  
;
พพ  !
}
ฟฟ 
catch
ภภ 
(
ภภ 
	Exception
ภภ 
ex
ภภ 
)
ภภ  
{
มม 
_logger
ยย 
.
ยย 
LogError
ยย  
(
ยย  !
$"
ยย! #
{
ยย# $
TAG
ยย$ '
}
ยย' (
$str
ยย( L
{
ยยL M
ex
ยยM O
.
ยยO P
Message
ยยP W
}
ยยW X
"
ยยX Y
)
ยยY Z
;
ยยZ [
return
รร 
	svcResult
รร  
;
รร  !
}
ฤฤ 
}
ลล 	
[
วว 	
AllowAnonymous
วว	 
]
วว 
[
ศศ 	
HttpPost
ศศ	 
(
ศศ 
$str
ศศ 
)
ศศ 
]
ศศ  
public
ษษ 
async
ษษ 
Task
ษษ 
<
ษษ 
ServiceResult
ษษ '
<
ษษ' (
bool
ษษ( ,
>
ษษ, -
>
ษษ- .
TestOrderAsync
ษษ/ =
(
ษษ= >
[
ษษ> ?
FromBody
ษษ? G
]
ษษG H
Order
ษษI N
order
ษษO T
)
ษษT U
{
สส 	
var
หห 
	svcResult
หห 
=
หห 
new
หห 
ServiceResult
หห  -
<
หห- .
bool
หห. 2
>
หห2 3
(
หห3 4
)
หห4 5
;
หห5 6
try
ฬฬ 
{
ออ 
var
ฮฮ 
res
ฮฮ 
=
ฮฮ 
await
ฮฮ 

_publisher
ฮฮ  *
.
ฮฮ* +%
PublishUpdateOrderAsync
ฮฮ+ B
(
ฮฮB C
order
ฮฮC H
,
ฮฮH I
null
ฮฮJ N
)
ฮฮN O
;
ฮฮO P
	svcResult
ฯฯ 
=
ฯฯ 
new
ฯฯ 
ServiceResult
ฯฯ  -
<
ฯฯ- .
bool
ฯฯ. 2
>
ฯฯ2 3
{
ะะ 
Data
ัั 
=
ัั 
res
ัั 
,
ัั 
Success
าา 
=
าา 
res
าา !
,
าา! "
Status
ำำ 
=
ำำ !
ServiceResultStatus
ำำ 0
.
ำำ0 1
Ok
ำำ1 3
}
ิิ 
;
ิิ 
return
ีี 
	svcResult
ีี  
;
ีี  !
}
ึึ 
catch
ืื 
(
ืื 
	Exception
ืื 
ex
ืื 
)
ืื  
{
ุุ 
_logger
ูู 
.
ูู 
LogError
ูู  
(
ูู  !
$"
ูู! #
{
ูู# $
TAG
ูู$ '
}
ูู' (
$str
ูู( M
{
ููM N
ex
ููN P
.
ููP Q
Message
ููQ X
}
ููX Y
"
ููY Z
)
ููZ [
;
ูู[ \
return
ฺฺ 
	svcResult
ฺฺ  
;
ฺฺ  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 4
)
4 5
]
5 6
public
฿฿ 
async
฿฿ 
Task
฿฿ 
<
฿฿ 
ServiceResult
฿฿ '
<
฿฿' (
Pagging
฿฿( /
<
฿฿/ 0
Order
฿฿0 5
>
฿฿5 6
>
฿฿6 7
>
฿฿7 8%
GetPageOrderByUserAsync
฿฿9 P
(
฿฿P Q
[
฿฿Q R
FromBody
฿฿R Z
]
฿฿Z [

Pagination
฿฿\ f

pagination
฿฿g q
,
฿฿q r
string
฿฿s y
userId฿฿z 
,฿฿ 
OrderStatus฿฿ 
orderStatus฿฿ 
)฿฿ 
{
เเ 	
var
แแ 
	svcResult
แแ 
=
แแ 
new
แแ 
ServiceResult
แแ  -
<
แแ- .
Pagging
แแ. 5
<
แแ5 6
Order
แแ6 ;
>
แแ; <
>
แแ< =
(
แแ= >
)
แแ> ?
;
แแ? @
try
โโ 
{
ใใ 
var
ไไ 
	orderPage
ไไ 
=
ไไ 
new
ไไ  #
Pagging
ไไ$ +
<
ไไ+ ,
Order
ไไ, 1
>
ไไ1 2
(
ไไ2 3
)
ไไ3 4
;
ไไ4 5
if
ๅๅ 
(
ๅๅ 
orderStatus
ๅๅ 
==
ๅๅ  "
OrderStatus
ๅๅ# .
.
ๅๅ. /
All
ๅๅ/ 2
)
ๅๅ2 3
{
ๆๆ 
	orderPage
็็ 
=
็็ 
await
็็  %
_orderService
็็& 3
.
็็3 4
GetOrderPageAsync
็็4 E
(
็็E F

pagination
็็F P
,
็็P Q
x
็็R S
=>
็็T V
x
็็W X
.
็็X Y
user_id
็็Y `
==
็็a c
userId
็็d j
)
็็j k
;
็็k l
}
่่ 
else
้้ 
{
๊๊ 
	orderPage
๋๋ 
=
๋๋ 
await
๋๋  %
_orderService
๋๋& 3
.
๋๋3 4
GetOrderPageAsync
๋๋4 E
(
๋๋E F

pagination
๋๋F P
,
๋๋P Q
x
๋๋R S
=>
๋๋T V
x
๋๋W X
.
๋๋X Y
user_id
๋๋Y `
==
๋๋a c
userId
๋๋d j
&&
๋๋k m
x
๋๋n o
.
๋๋o p
order_status
๋๋p |
==
๋๋} 
orderStatus๋๋ 
)๋๋ 
;๋๋ 
}
์์ 
	svcResult
ํํ 
=
ํํ 
new
ํํ 
ServiceResult
ํํ  -
<
ํํ- .
Pagging
ํํ. 5
<
ํํ5 6
Order
ํํ6 ;
>
ํํ; <
>
ํํ< =
{
๎๎ 
Data
๏๏ 
=
๏๏ 
	orderPage
๏๏ $
,
๏๏$ %
Success
๐๐ 
=
๐๐ 
true
๐๐ "
,
๐๐" #
Status
๑๑ 
=
๑๑ !
ServiceResultStatus
๑๑ 0
.
๑๑0 1
Ok
๑๑1 3
}
๒๒ 
;
๒๒ 
return
๓๓ 
	svcResult
๓๓  
;
๓๓  !
}
๔๔ 
catch
๕๕ 
(
๕๕ 
	Exception
๕๕ 
ex
๕๕ 
)
๕๕  
{
๖๖ 
_logger
๗๗ 
.
๗๗ 
LogError
๗๗  
(
๗๗  !
$"
๗๗! #
{
๗๗# $
TAG
๗๗$ '
}
๗๗' (
$str
๗๗( V
{
๗๗V W
ex
๗๗W Y
.
๗๗Y Z
Message
๗๗Z a
}
๗๗a b
"
๗๗b c
)
๗๗c d
;
๗๗d e
return
๘๘ 
	svcResult
๘๘  
;
๘๘  !
}
๙๙ 
}
๚๚ 	
}
 
} โ
tC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\ProductEnpoint\ProductController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class 
ProductController "
:# $
BaseAuthController% 7
<7 8
ProductController8 I
>I J
{ 
private 
const 
string 
TAG  
=! "
$str# 6
;6 7
private 
readonly 
IProductService (
_productService) 8
;8 9
public 
ProductController  
(  !
IServiceProvider! 1
serviceProvider2 A
)A B
:C D
baseE I
(I J
serviceProviderJ Y
)Y Z
{ 	
_productService 
= 
GetRequiredService 0
<0 1
IProductService1 @
>@ A
(A B
)B C
;C D
} 	
[## 	
HttpPost##	 
(## 
$str## *
)##* +
]##+ ,
public$$ 
async$$ 
Task$$ 
<$$ 
ServiceResult$$ '
<$$' (
bool$$( ,
>$$, -
>$$- .&
InsertProductCategoryAsync$$/ I
($$I J
[$$J K
FromBody$$K S
]$$S T
ProductCategory$$U d
productCategory$$e t
)$$t u
{%% 	
var&& 
	svcResult&& 
=&& 
new&& 
ServiceResult&&  -
<&&- .
bool&&. 2
>&&2 3
(&&3 4
)&&4 5
;&&5 6
try'' 
{(( 
var)) 
res)) 
=)) 
await)) 
_productService))  /
.))/ 0&
InsertProductCategoryAsync))0 J
())J K
productCategory))K Z
)))Z [
;))[ \
	svcResult** 
=** 
new** 
ServiceResult**  -
<**- .
bool**. 2
>**2 3
{++ 
Data,, 
=,, 
res,, 
,,, 
Success-- 
=-- 
res-- !
,--! "
Status.. 
=.. 
ServiceResultStatus.. 0
...0 1
Ok..1 3
}// 
;// 
return00 
	svcResult00  
;00  !
}11 
catch22 
(22 
	Exception22 
ex22 
)22  
{33 
_logger44 
.44 
LogError44  
(44  !
$"44! #
{44# $
TAG44$ '
}44' (
$str44( Y
{44Y Z
ex44Z \
.44\ ]
Message44] d
}44d e
"44e f
)44f g
;44g h
return55 
	svcResult55  
;55  !
}66 
}77 	
[?? 	
HttpPost??	 
(?? 
$str?? *
)??* +
]??+ ,
public@@ 
async@@ 
Task@@ 
<@@ 
ServiceResult@@ '
<@@' (
bool@@( ,
>@@, -
>@@- .&
UpdateProductCategoryAsync@@/ I
(@@I J
[@@J K
FromBody@@K S
]@@S T
ProductCategory@@U d
productCategory@@e t
)@@t u
{AA 	
varBB 
	svcResultBB 
=BB 
newBB 
ServiceResultBB  -
<BB- .
boolBB. 2
>BB2 3
(BB3 4
)BB4 5
;BB5 6
tryCC 
{DD 
varEE 
resEE 
=EE 
awaitEE 
_productServiceEE  /
.EE/ 0&
UpdateProductCategoryAsyncEE0 J
(EEJ K
productCategoryEEK Z
)EEZ [
;EE[ \
	svcResultFF 
=FF 
newFF 
ServiceResultFF  -
<FF- .
boolFF. 2
>FF2 3
{GG 
DataHH 
=HH 
resHH 
,HH 
SuccessII 
=II 
resII !
,II! "
StatusJJ 
=JJ 
ServiceResultStatusJJ 0
.JJ0 1
OkJJ1 3
}KK 
;KK 
returnLL 
	svcResultLL  
;LL  !
}MM 
catchNN 
(NN 
	ExceptionNN 
exNN 
)NN  
{OO 
_loggerPP 
.PP 
LogErrorPP  
(PP  !
$"PP! #
{PP# $
TAGPP$ '
}PP' (
$strPP( Y
{PPY Z
exPPZ \
.PP\ ]
MessagePP] d
}PPd e
"PPe f
)PPf g
;PPg h
returnQQ 
	svcResultQQ  
;QQ  !
}RR 
}SS 	
[[[ 	
HttpPost[[	 
([[ 
$str[[ *
)[[* +
][[+ ,
public\\ 
async\\ 
Task\\ 
<\\ 
ServiceResult\\ '
<\\' (
DeleteStatus\\( 4
>\\4 5
>\\5 6&
DeleteProductCategoryAsync\\7 Q
(\\Q R
[\\R S
FromBody\\S [
]\\[ \"
ProductCategoryRequest\\] s
productCategory	\\t 
)
\\ 
{]] 	
var^^ 
	svcResult^^ 
=^^ 
new^^ 
ServiceResult^^  -
<^^- .
DeleteStatus^^. :
>^^: ;
(^^; <
)^^< =
;^^= >
try__ 
{`` 
varaa 
	deleteResaa 
=aa 
awaitaa  %
_productServiceaa& 5
.aa5 6&
DeleteProductCategoryAsyncaa6 P
(aaP Q
productCategoryaaQ `
)aa` a
;aaa b
	svcResultbb 
=bb 
newbb 
ServiceResultbb  -
<bb- .
DeleteStatusbb. :
>bb: ;
{cc 
Datadd 
=dd 
	deleteResdd $
,dd$ %
Successee 
=ee 
trueee "
,ee" #
Statusff 
=ff 
ServiceResultStatusff 0
.ff0 1
Okff1 3
}gg 
;gg 
returnii 
	svcResultii  
;ii  !
}jj 
catchkk 
(kk 
	Exceptionkk 
exkk 
)kk  
{ll 
_loggermm 
.mm 
LogErrormm  
(mm  !
$"mm! #
{mm# $
TAGmm$ '
}mm' (
$strmm( Y
{mmY Z
exmmZ \
.mm\ ]
Messagemm] d
}mmd e
"mme f
)mmf g
;mmg h
returnnn 
	svcResultnn  
;nn  !
}oo 
}pp 	
[rr 	
AllowAnonymousrr	 
]rr 
[xx 	
HttpPostxx	 
(xx 
$strxx +
)xx+ ,
]xx, -
publicyy 
asyncyy 
Taskyy 
<yy 
ServiceResultyy '
<yy' (
Paggingyy( /
<yy/ 0
ProductCategoryyy0 ?
>yy? @
>yy@ A
>yyA B'
GetPageProductCategoryAsyncyyC ^
(yy^ _
[yy_ `
FromBodyyy` h
]yyh i

Paginationyyj t

paginationyyu 
)	yy 
{zz 	
var{{ 
	svcResult{{ 
={{ 
new{{ 
ServiceResult{{  -
<{{- .
Pagging{{. 5
<{{5 6
ProductCategory{{6 E
>{{E F
>{{F G
({{G H
){{H I
;{{I J
try|| 
{}} 
var~~ 
productCategoryPage~~ '
=~~( )
await~~* /
_productService~~0 ?
.~~? @,
 GetProductCategoriesPaggingAsync~~@ `
(~~` a

pagination~~a k
)~~k l
;~~l m
	svcResult 
= 
new 
ServiceResult  -
<- .
Pagging. 5
<5 6
ProductCategory6 E
>E F
>F G
{
 
Data
 
=
 !
productCategoryPage
 .
,
. /
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( Z
{
Z [
ex
[ ]
.
] ^
Message
^ e
}
e f
"
f g
)
g h
;
h i
return
 
	svcResult
  
;
  !
}
 
}
 	
[
 	
AllowAnonymous
	 
]
 
[
 	
HttpPost
	 
(
 
$str
 %
)
% &
]
& '
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
IEnumerable
( 3
<
3 4
ProductCategory
4 C
>
C D
>
D E
>
E F'
GetProductCategoriesAsync
G `
(
` a
)
a b
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
IEnumerable
. 9
<
9 :
ProductCategory
: I
>
I J
>
J K
(
K L
)
L M
;
M N
try
 
{
 
var
 !
productCategoryPage
 '
=
( )
await
* /
_productService
0 ?
.
? @'
GetProductCategoriesAsync
@ Y
(
Y Z
)
Z [
;
[ \
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
IEnumerable
. 9
<
9 :
ProductCategory
: I
>
I J
>
J K
{
 
Data
 
=
 !
productCategoryPage
 .
,
. /
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( X
{
X Y
ex
Y [
.
[ \
Message
\ c
}
c d
"
d e
)
e f
;
f g
return
กก 
	svcResult
กก  
;
กก  !
}
ขข 
}
ฃฃ 	
[
ฅฅ 	
AllowAnonymous
ฅฅ	 
]
ฅฅ 
[
ฆฆ 	
HttpGet
ฆฆ	 
(
ฆฆ 
$str
ฆฆ 6
)
ฆฆ6 7
]
ฆฆ7 8
public
งง 
async
งง 
Task
งง 
<
งง 
ServiceResult
งง '
<
งง' (
ProductCategory
งง( 7
>
งง7 8
>
งง8 9%
GetProductCategoryAsync
งง: Q
(
งงQ R
string
งงR X
productCategoryId
งงY j
)
งงj k
{
จจ 	
var
ฉฉ 
	svcResult
ฉฉ 
=
ฉฉ 
new
ฉฉ 
ServiceResult
ฉฉ  -
<
ฉฉ- .
ProductCategory
ฉฉ. =
>
ฉฉ= >
(
ฉฉ> ?
)
ฉฉ? @
;
ฉฉ@ A
try
ชช 
{
ซซ 
var
ฌฌ 
productCategory
ฌฌ #
=
ฌฌ$ %
await
ฌฌ& +
_productService
ฌฌ, ;
.
ฌฌ; <%
GetProductCategoryAsync
ฌฌ< S
(
ฌฌS T
productCategoryId
ฌฌT e
)
ฌฌe f
;
ฌฌf g
	svcResult
ญญ 
=
ญญ 
new
ญญ 
ServiceResult
ญญ  -
<
ญญ- .
ProductCategory
ญญ. =
>
ญญ= >
{
ฎฎ 
Data
ฏฏ 
=
ฏฏ 
productCategory
ฏฏ *
,
ฏฏ* +
Success
ฐฐ 
=
ฐฐ 
true
ฐฐ "
,
ฐฐ" #
Status
ฑฑ 
=
ฑฑ !
ServiceResultStatus
ฑฑ 0
.
ฑฑ0 1
Ok
ฑฑ1 3
}
ฒฒ 
;
ฒฒ 
return
ณณ 
	svcResult
ณณ  
;
ณณ  !
}
ดด 
catch
ตต 
(
ตต 
	Exception
ตต 
ex
ตต 
)
ตต  
{
ถถ 
_logger
ทท 
.
ทท 
LogError
ทท  
(
ทท  !
$"
ทท! #
{
ทท# $
TAG
ทท$ '
}
ทท' (
$str
ทท( V
{
ททV W
ex
ททW Y
.
ททY Z
Message
ททZ a
}
ททa b
"
ททb c
)
ททc d
;
ททd e
return
ธธ 
	svcResult
ธธ  
;
ธธ  !
}
นน 
}
บบ 	
[
ฦฦ 	
HttpPost
ฦฦ	 
(
ฦฦ 
$str
ฦฦ 
)
ฦฦ 
]
ฦฦ 
public
วว 
async
วว 
Task
วว 
<
วว 
ServiceResult
วว '
<
วว' (
bool
วว( ,
>
วว, -
>
วว- . 
InsertProductAsync
วว/ A
(
ววA B
[
ววB C
FromBody
ววC K
]
ววK L
ProductRequest
ววM [
product
วว\ c
)
ววc d
{
ศศ 	
var
ษษ 
	svcResult
ษษ 
=
ษษ 
new
ษษ 
ServiceResult
ษษ  -
<
ษษ- .
bool
ษษ. 2
>
ษษ2 3
(
ษษ3 4
)
ษษ4 5
;
ษษ5 6
try
สส 
{
หห 
var
ฬฬ 
res
ฬฬ 
=
ฬฬ 
await
ฬฬ 
_productService
ฬฬ  /
.
ฬฬ/ 0 
InsertProductAsync
ฬฬ0 B
(
ฬฬB C
product
ฬฬC J
)
ฬฬJ K
;
ฬฬK L
	svcResult
ออ 
=
ออ 
new
ออ 
ServiceResult
ออ  -
<
ออ- .
bool
ออ. 2
>
ออ2 3
{
ฮฮ 
Data
ฯฯ 
=
ฯฯ 
res
ฯฯ 
,
ฯฯ 
Success
ะะ 
=
ะะ 
res
ะะ !
,
ะะ! "
Status
ัั 
=
ัั !
ServiceResultStatus
ัั 0
.
ัั0 1
Ok
ัั1 3
}
าา 
;
าา 
return
ำำ 
	svcResult
ำำ  
;
ำำ  !
}
ิิ 
catch
ีี 
(
ีี 
	Exception
ีี 
ex
ีี 
)
ีี  
{
ึึ 
_logger
ืื 
.
ืื 
LogError
ืื  
(
ืื  !
$"
ืื! #
{
ืื# $
TAG
ืื$ '
}
ืื' (
$str
ืื( Q
{
ืืQ R
ex
ืืR T
.
ืืT U
Message
ืืU \
}
ืื\ ]
"
ืื] ^
)
ืื^ _
;
ืื_ `
return
ุุ 
	svcResult
ุุ  
;
ุุ  !
}
ูู 
}
ฺฺ 	
[
โโ 	
HttpPost
โโ	 
(
โโ 
$str
โโ 
)
โโ 
]
โโ 
public
ใใ 
async
ใใ 
Task
ใใ 
<
ใใ 
ServiceResult
ใใ '
<
ใใ' (
bool
ใใ( ,
>
ใใ, -
>
ใใ- . 
UpdateProductAsync
ใใ/ A
(
ใใA B
[
ใใB C
FromBody
ใใC K
]
ใใK L
ProductRequest
ใใM [
product
ใใ\ c
)
ใใc d
{
ไไ 	
var
ๅๅ 
	svcResult
ๅๅ 
=
ๅๅ 
new
ๅๅ 
ServiceResult
ๅๅ  -
<
ๅๅ- .
bool
ๅๅ. 2
>
ๅๅ2 3
(
ๅๅ3 4
)
ๅๅ4 5
;
ๅๅ5 6
try
ๆๆ 
{
็็ 
var
่่ 
res
่่ 
=
่่ 
await
่่ 
_productService
่่  /
.
่่/ 0 
UpdateProductAsync
่่0 B
(
่่B C
product
่่C J
)
่่J K
;
่่K L
	svcResult
้้ 
=
้้ 
new
้้ 
ServiceResult
้้  -
<
้้- .
bool
้้. 2
>
้้2 3
{
๊๊ 
Data
๋๋ 
=
๋๋ 
res
๋๋ 
,
๋๋ 
Success
์์ 
=
์์ 
res
์์ !
,
์์! "
Status
ํํ 
=
ํํ !
ServiceResultStatus
ํํ 0
.
ํํ0 1
Ok
ํํ1 3
}
๎๎ 
;
๎๎ 
return
๏๏ 
	svcResult
๏๏  
;
๏๏  !
}
๐๐ 
catch
๑๑ 
(
๑๑ 
	Exception
๑๑ 
ex
๑๑ 
)
๑๑  
{
๒๒ 
_logger
๓๓ 
.
๓๓ 
LogError
๓๓  
(
๓๓  !
$"
๓๓! #
{
๓๓# $
TAG
๓๓$ '
}
๓๓' (
$str
๓๓( Q
{
๓๓Q R
ex
๓๓R T
.
๓๓T U
Message
๓๓U \
}
๓๓\ ]
"
๓๓] ^
)
๓๓^ _
;
๓๓_ `
return
๔๔ 
	svcResult
๔๔  
;
๔๔  !
}
๕๕ 
}
๖๖ 	
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
DeleteStatus
( 4
>
4 5
>
5 6 
DeleteProductAsync
7 I
(
I J
[
J K
FromBody
K S
]
S T
Product
U \
product
] d
)
d e
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
DeleteStatus
. :
>
: ;
(
; <
)
< =
;
= >
try
 
{
 
var
 
	deleteRes
 
=
 
await
  %
_productService
& 5
.
5 6 
DeleteProductAsync
6 H
(
H I
product
I P
)
P Q
;
Q R
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
DeleteStatus
. :
>
: ;
{
 
Data
 
=
 
	deleteRes
 $
,
$ %
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( Q
{
Q R
ex
R T
.
T U
Message
U \
}
\ ]
"
] ^
)
^ _
;
_ `
return
 
	svcResult
  
;
  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 
)
  
]
  !
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
DeleteStatus
( 4
>
4 5
>
5 6!
DeleteProductsAsync
7 J
(
J K
[
K L
FromBody
L T
]
T U
IEnumerable
V a
<
a b
Product
b i
>
i j
products
k s
)
s t
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
DeleteStatus
. :
>
: ;
(
; <
)
< =
;
= >
try
 
{
 
var
 
	deleteRes
 
=
 
await
  %
_productService
& 5
.
5 6!
DeleteProductsAsync
6 I
(
I J
products
J R
)
R S
;
S T
	svcResult
กก 
=
กก 
new
กก 
ServiceResult
กก  -
<
กก- .
DeleteStatus
กก. :
>
กก: ;
{
ขข 
Data
ฃฃ 
=
ฃฃ 
	deleteRes
ฃฃ $
,
ฃฃ$ %
Success
คค 
=
คค 
true
คค "
,
คค" #
Status
ฅฅ 
=
ฅฅ !
ServiceResultStatus
ฅฅ 0
.
ฅฅ0 1
Ok
ฅฅ1 3
}
ฆฆ 
;
ฆฆ 
return
จจ 
	svcResult
จจ  
;
จจ  !
}
ฉฉ 
catch
ชช 
(
ชช 
	Exception
ชช 
ex
ชช 
)
ชช  
{
ซซ 
_logger
ฌฌ 
.
ฌฌ 
LogError
ฌฌ  
(
ฌฌ  !
$"
ฌฌ! #
{
ฌฌ# $
TAG
ฌฌ$ '
}
ฌฌ' (
$str
ฌฌ( R
{
ฌฌR S
ex
ฌฌS U
.
ฌฌU V
Message
ฌฌV ]
}
ฌฌ] ^
"
ฌฌ^ _
)
ฌฌ_ `
;
ฌฌ` a
return
ญญ 
	svcResult
ญญ  
;
ญญ  !
}
ฎฎ 
}
ฏฏ 	
[
ฑฑ 	
AllowAnonymous
ฑฑ	 
]
ฑฑ 
[
ธธ 	
HttpPost
ธธ	 
(
ธธ 
$str
ธธ 
)
ธธ 
]
ธธ 
public
นน 
async
นน 
Task
นน 
<
นน 
ServiceResult
นน '
<
นน' (
Pagging
นน( /
<
นน/ 0
ProductRespone
นน0 >
>
นน> ?
>
นน? @
>
นน@ A!
GetPageProductAsync
นนB U
(
นนU V
[
นนV W
FromBody
นนW _
]
นน_ `"
ProductFilterRequest
นนa u
request
นนv }
)
นน} ~
{
บบ 	
var
ปป 
	svcResult
ปป 
=
ปป 
new
ปป 
ServiceResult
ปป  -
<
ปป- .
Pagging
ปป. 5
<
ปป5 6
ProductRespone
ปป6 D
>
ปปD E
>
ปปE F
(
ปปF G
)
ปปG H
;
ปปH I
try
ผผ 
{
ฝฝ 
var
พพ 
productPage
พพ 
=
พพ  !
await
พพ" '
_productService
พพ( 7
.
พพ7 8%
GetProductsPaggingAsync
พพ8 O
(
พพO P
request
พพP W
)
พพW X
;
พพX Y
	svcResult
ฟฟ 
=
ฟฟ 
new
ฟฟ 
ServiceResult
ฟฟ  -
<
ฟฟ- .
Pagging
ฟฟ. 5
<
ฟฟ5 6
ProductRespone
ฟฟ6 D
>
ฟฟD E
>
ฟฟE F
{
ภภ 
Data
มม 
=
มม 
productPage
มม &
,
มม& '
Success
ยย 
=
ยย 
true
ยย "
,
ยย" #
Status
รร 
=
รร !
ServiceResultStatus
รร 0
.
รร0 1
Ok
รร1 3
}
ฤฤ 
;
ฤฤ 
return
ลล 
	svcResult
ลล  
;
ลล  !
}
ฦฦ 
catch
วว 
(
วว 
	Exception
วว 
ex
วว 
)
วว  
{
ศศ 
_logger
ษษ 
.
ษษ 
LogError
ษษ  
(
ษษ  !
$"
ษษ! #
{
ษษ# $
TAG
ษษ$ '
}
ษษ' (
$str
ษษ( R
{
ษษR S
ex
ษษS U
.
ษษU V
Message
ษษV ]
}
ษษ] ^
"
ษษ^ _
)
ษษ_ `
;
ษษ` a
return
สส 
	svcResult
สส  
;
สส  !
}
หห 
}
ฬฬ 	
[
ำำ 	
HttpPost
ำำ	 
(
ำำ 
$str
ำำ !
)
ำำ! "
]
ำำ" #
public
ิิ 
async
ิิ 
Task
ิิ 
<
ิิ 
ServiceResult
ิิ '
<
ิิ' (
Pagging
ิิ( /
<
ิิ/ 0
ProductRespone
ิิ0 >
>
ิิ> ?
>
ิิ? @
>
ิิ@ A'
GetPageProductClientAsync
ิิB [
(
ิิ[ \
[
ิิ\ ]
FromBody
ิิ] e
]
ิิe f"
ProductFilterRequest
ิิg {
requestิิ| 
)ิิ 
{
ีี 	
var
ึึ 
	svcResult
ึึ 
=
ึึ 
new
ึึ 
ServiceResult
ึึ  -
<
ึึ- .
Pagging
ึึ. 5
<
ึึ5 6
ProductRespone
ึึ6 D
>
ึึD E
>
ึึE F
(
ึึF G
)
ึึG H
;
ึึH I
try
ืื 
{
ุุ 
var
ูู 
productPage
ูู 
=
ูู  !
await
ูู" '
_productService
ูู( 7
.
ูู7 8%
GetProductsPaggingAsync
ูู8 O
(
ููO P
request
ููP W
,
ููW X
isAdmin
ููY `
:
ูู` a
true
ููb f
)
ููf g
;
ููg h
	svcResult
ฺฺ 
=
ฺฺ 
new
ฺฺ 
ServiceResult
ฺฺ  -
<
ฺฺ- .
Pagging
ฺฺ. 5
<
ฺฺ5 6
ProductRespone
ฺฺ6 D
>
ฺฺD E
>
ฺฺE F
{
 
Data
 
=
 
productPage
 &
,
& '
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
฿฿ 
;
฿฿ 
return
เเ 
	svcResult
เเ  
;
เเ  !
}
แแ 
catch
โโ 
(
โโ 
	Exception
โโ 
ex
โโ 
)
โโ  
{
ใใ 
_logger
ไไ 
.
ไไ 
LogError
ไไ  
(
ไไ  !
$"
ไไ! #
{
ไไ# $
TAG
ไไ$ '
}
ไไ' (
$str
ไไ( R
{
ไไR S
ex
ไไS U
.
ไไU V
Message
ไไV ]
}
ไไ] ^
"
ไไ^ _
)
ไไ_ `
;
ไไ` a
return
ๅๅ 
	svcResult
ๅๅ  
;
ๅๅ  !
}
ๆๆ 
}
็็ 	
[
้้ 	
AllowAnonymous
้้	 
]
้้ 
[
๏๏ 	
HttpGet
๏๏	 
(
๏๏ 
$str
๏๏ 
)
๏๏ 
]
๏๏  
public
๐๐ 
async
๐๐ 
Task
๐๐ 
<
๐๐ 
ServiceResult
๐๐ '
<
๐๐' (
ProductRespone
๐๐( 6
>
๐๐6 7
>
๐๐7 8
GetProductAsync
๐๐9 H
(
๐๐H I
string
๐๐I O
	productId
๐๐P Y
)
๐๐Y Z
{
๑๑ 	
var
๒๒ 
	svcResult
๒๒ 
=
๒๒ 
new
๒๒ 
ServiceResult
๒๒  -
<
๒๒- .
ProductRespone
๒๒. <
>
๒๒< =
(
๒๒= >
)
๒๒> ?
;
๒๒? @
try
๓๓ 
{
๔๔ 
var
๕๕ 
product
๕๕ 
=
๕๕ 
await
๕๕ #
_productService
๕๕$ 3
.
๕๕3 4
GetProductAsync
๕๕4 C
(
๕๕C D
	productId
๕๕D M
)
๕๕M N
;
๕๕N O
	svcResult
๖๖ 
=
๖๖ 
new
๖๖ 
ServiceResult
๖๖  -
<
๖๖- .
ProductRespone
๖๖. <
>
๖๖< =
{
๗๗ 
Data
๘๘ 
=
๘๘ 
product
๘๘ "
,
๘๘" #
Success
๙๙ 
=
๙๙ 
true
๙๙ "
,
๙๙" #
Status
๚๚ 
=
๚๚ !
ServiceResultStatus
๚๚ 0
.
๚๚0 1
Ok
๚๚1 3
}
๛๛ 
;
๛๛ 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( N
{
N O
ex
O Q
.
Q R
Message
R Y
}
Y Z
"
Z [
)
[ \
;
\ ]
return
 
	svcResult
  
;
  !
}
 
}
 	
}
 
} ู
vC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\ShipmentEnpoint\ShipmentController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
public 

class 
ShipmentController #
:$ %
BaseAuthController& 8
<8 9
ShipmentController9 K
>K L
{ 
public 
ShipmentController !
(! "
IServiceProvider" 2
serviceProvider3 B
)B C
:C D
baseD H
(H I
serviceProviderI X
)X Y
{		 	
} 	
} 
} ู
vC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\SupplierEnpoint\SupplierController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
public 

class 
SupplierController #
:$ %
BaseAuthController& 8
<8 9
SupplierController9 K
>K L
{ 
public 
SupplierController !
(! "
IServiceProvider" 2
serviceProvider3 B
)B C
:C D
baseD H
(H I
serviceProviderI X
)X Y
{ 	
}

 	
} 
} จญ
rC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\UserEnpoint\UserInfoController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
[ 
	Authorize 
] 
public 

class 
UserInfoController #
:$ %
BaseAuthController& 8
<8 9
UserInfoController9 K
>K L
{ 
private 
const 
string 
TAG  
=! "
$str# 7
;7 8
	protected 
readonly 
IUserService '
_userService( 4
;4 5
	protected 
readonly 
IRedisCached '
_redisCached( 4
;4 5
	protected 
readonly #
IJwtAuthencationManager 2
_jwtAuthencation3 C
;C D
	protected 
readonly 
IStorageClient )
_storageClient* 8
;8 9
	protected 
readonly 
IAddressInfoService .
_addressInfoService/ B
;B C
public"" 
UserInfoController"" !
(""! "
IServiceProvider""" 2
serviceProvider""3 B
)""B C
:""D E
base""F J
(""J K
serviceProvider""K Z
)""Z [
{## 	
_userService$$ 
=$$ 
GetRequiredService$$ -
<$$- .
IUserService$$. :
>$$: ;
($$; <
)$$< =
;$$= >
_jwtAuthencation%% 
=%% 
GetRequiredService%% 1
<%%1 2#
IJwtAuthencationManager%%2 I
>%%I J
(%%J K
)%%K L
;%%L M
_redisCached&& 
=&& 
GetRequiredService&& -
<&&- .
IRedisCached&&. :
>&&: ;
(&&; <
)&&< =
;&&= >
_storageClient'' 
='' 
GetRequiredService'' /
<''/ 0
IStorageClient''0 >
>''> ?
(''? @
)''@ A
;''A B
_addressInfoService(( 
=((  !
GetRequiredService((" 4
<((4 5
IAddressInfoService((5 H
>((H I
(((I J
)((J K
;((K L
})) 	
[22 	
HttpGet22	 
]22 
public33 
async33 
Task33 
<33 
ServiceResult33 '
<33' (
IEnumerable33( 3
<333 4
User334 8
>338 9
>339 :
>33: ;
GetUsersAsync33< I
(33I J
)33J K
{44 	
var55 
	svcResult55 
=55 
new55 
ServiceResult55  -
<55- .
IEnumerable55. 9
<559 :
User55: >
>55> ?
>55? @
(55@ A
)55A B
;55B C
try66 
{77 
var99 
users99 
=99 
await99 !
_userService99" .
.99. /
GetUsersAsync99/ <
(99< =
)99= >
;99> ?
	svcResult:: 
=:: 
new:: 
ServiceResult::  -
<::- .
IEnumerable::. 9
<::9 :
User::: >
>::> ?
>::? @
{;; 
Data<< 
=<< 
users<<  
,<<  !
Success== 
=== 
true== "
,==" #
Status>> 
=>> 
ServiceResultStatus>> 0
.>>0 1
Ok>>1 3
}?? 
;?? 
return@@ 
	svcResult@@  
;@@  !
}AA 
catchBB 
(BB 
	ExceptionBB 
exBB 
)BB  
{CC 
_loggerDD 
.DD 
LogErrorDD  
(DD  !
$"DD! #
{DD# $
TAGDD$ '
}DD' (
$strDD( L
{DDL M
exDDM O
.DDO P
MessageDDP W
}DDW X
"DDX Y
)DDY Z
;DDZ [
returnEE 
	svcResultEE  
;EE  !
}FF 
}GG 	
[MM 	
HttpPostMM	 
(MM 
$strMM 
)MM 
]MM 
publicNN 
asyncNN 
TaskNN 
<NN 
ServiceResultNN '
<NN' (
PaggingNN( /
<NN/ 0
UserNN0 4
>NN4 5
>NN5 6
>NN6 7
GetUserPageAsyncNN8 H
(NNH I
[NNI J
FromBodyNNJ R
]NNR S

PaginationNNT ^

paginationNN_ i
)NNi j
{OO 	
varPP 
	svcResultPP 
=PP 
newPP 
ServiceResultPP  -
<PP- .
PaggingPP. 5
<PP5 6
UserPP6 :
>PP: ;
>PP; <
(PP< =
)PP= >
;PP> ?
tryQQ 
{RR 
varTT 

pageResultTT 
=TT  
awaitTT! &
_userServiceTT' 3
.TT3 4
GetUserPageAsyncTT4 D
(TTD E

paginationTTE O
)TTO P
;TTP Q
	svcResultUU 
=UU 
newUU 
ServiceResultUU  -
<UU- .
PaggingUU. 5
<UU5 6
UserUU6 :
>UU: ;
>UU; <
{VV 
DataWW 
=WW 

pageResultWW %
,WW% &
SuccessXX 
=XX 
trueXX "
,XX" #
StatusYY 
=YY 
ServiceResultStatusYY 0
.YY0 1
OkYY1 3
}ZZ 
;ZZ 
return[[ 
	svcResult[[  
;[[  !
}\\ 
catch]] 
(]] 
	Exception]] 
ex]] 
)]]  
{^^ 
_logger__ 
.__ 
LogError__  
(__  !
$"__! #
{__# $
TAG__$ '
}__' (
$str__( O
{__O P
ex__P R
.__R S
Message__S Z
}__Z [
"__[ \
)__\ ]
;__] ^
return`` 
	svcResult``  
;``  !
}aa 
}bb 	
[ii 	
HttpPostii	 
(ii 
$strii 
)ii 
]ii 
publicjj 
asyncjj 
Taskjj 
<jj 
ServiceResultjj '
<jj' (
booljj( ,
>jj, -
>jj- .
InsertUserAsyncjj/ >
(jj> ?
[jj? @
FromBodyjj@ H
]jjH I
UserjjJ N
userjjO S
)jjS T
{kk 	
varll 
	svcResultll 
=ll 
newll 
ServiceResultll  -
<ll- .
boolll. 2
>ll2 3
(ll3 4
)ll4 5
;ll5 6
trymm 
{nn 
varpp 
	resInsertpp 
=pp 
awaitpp  %
_userServicepp& 2
.pp2 3
InsertUserAsyncpp3 B
(ppB C
userppC G
)ppG H
;ppH I
	svcResultqq 
=qq 
newqq 
ServiceResultqq  -
<qq- .
boolqq. 2
>qq2 3
{rr 
Datass 
=ss 
	resInsertss $
,ss$ %
Successtt 
=tt 
truett "
,tt" #
Statusuu 
=uu 
ServiceResultStatusuu 0
.uu0 1
Okuu1 3
}vv 
;vv 
returnww 
	svcResultww  
;ww  !
}xx 
catchyy 
(yy 
	Exceptionyy 
exyy 
)yy  
{zz 
_logger{{ 
.{{ 
LogError{{  
({{  !
$"{{! #
{{{# $
TAG{{$ '
}{{' (
$str{{( N
{{{N O
ex{{O Q
.{{Q R
Message{{R Y
}{{Y Z
"{{Z [
){{[ \
;{{\ ]
return|| 
	svcResult||  
;||  !
}}} 
}~~ 	
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
bool
( ,
>
, -
>
- .
DeleteUserAsync
/ >
(
> ?
[
? @
FromBody
@ H
]
H I
List
J N
<
N O
string
O U
>
U V
userIds
W ^
)
^ _
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
(
3 4
)
4 5
;
5 6
try
 
{
 
var
 
	resDelete
 
=
 
await
  %
_userService
& 2
.
2 3
DeleteUserAsync
3 B
(
B C
userIds
C J
)
J K
;
K L
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
{
 
Data
 
=
 
	resDelete
 $
,
$ %
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( N
{
N O
ex
O Q
.
Q R
Message
R Y
}
Y Z
"
Z [
)
[ \
;
\ ]
return
 
	svcResult
  
;
  !
}
 
}
 	
[
กก 	
HttpPost
กก	 
(
กก 
$str
กก 
)
กก 
]
กก 
public
ขข 
async
ขข 
Task
ขข 
<
ขข 
ServiceResult
ขข '
<
ขข' (
bool
ขข( ,
>
ขข, -
>
ขข- .
UpdateUserAsync
ขข/ >
(
ขข> ?
[
ขข? @
FromBody
ขข@ H
]
ขขH I
User
ขขJ N
user
ขขO S
)
ขขS T
{
ฃฃ 	
var
คค 
	svcResult
คค 
=
คค 
new
คค 
ServiceResult
คค  -
<
คค- .
bool
คค. 2
>
คค2 3
(
คค3 4
)
คค4 5
;
คค5 6
try
ฅฅ 
{
ฆฆ 
var
จจ 
	resUpdate
จจ 
=
จจ 
await
จจ  %
_userService
จจ& 2
.
จจ2 3
UpdateUserAsync
จจ3 B
(
จจB C
user
จจC G
)
จจG H
;
จจH I
	svcResult
ฉฉ 
=
ฉฉ 
new
ฉฉ 
ServiceResult
ฉฉ  -
<
ฉฉ- .
bool
ฉฉ. 2
>
ฉฉ2 3
{
ชช 
Data
ซซ 
=
ซซ 
	resUpdate
ซซ $
,
ซซ$ %
Success
ฌฌ 
=
ฌฌ 
true
ฌฌ "
,
ฌฌ" #
Status
ญญ 
=
ญญ !
ServiceResultStatus
ญญ 0
.
ญญ0 1
Ok
ญญ1 3
}
ฎฎ 
;
ฎฎ 
return
ฏฏ 
	svcResult
ฏฏ  
;
ฏฏ  !
}
ฐฐ 
catch
ฑฑ 
(
ฑฑ 
	Exception
ฑฑ 
ex
ฑฑ 
)
ฑฑ  
{
ฒฒ 
_logger
ณณ 
.
ณณ 
LogError
ณณ  
(
ณณ  !
$"
ณณ! #
{
ณณ# $
TAG
ณณ$ '
}
ณณ' (
$str
ณณ( N
{
ณณN O
ex
ณณO Q
.
ณณQ R
Message
ณณR Y
}
ณณY Z
"
ณณZ [
)
ณณ[ \
;
ณณ\ ]
return
ดด 
	svcResult
ดด  
;
ดด  !
}
ตต 
}
ถถ 	
[
ธธ 	
AllowAnonymous
ธธ	 
]
ธธ 
[
นน 	
HttpPost
นน	 
(
นน 
$str
นน  
)
นน  !
]
นน! "
public
บบ 
async
บบ 
Task
บบ 
<
บบ 
ServiceResult
บบ '
<
บบ' (
string
บบ( .
>
บบ. /
>
บบ/ 0
AutheticateAsync
บบ1 A
(
บบA B
[
บบB C
FromBody
บบC K
]
บบK L
UserRequest
บบM X
request
บบY `
)
บบ` a
{
ปป 	
var
ผผ 
	svcResult
ผผ 
=
ผผ 
new
ผผ 
ServiceResult
ผผ  -
<
ผผ- .
string
ผผ. 4
>
ผผ4 5
(
ผผ5 6
)
ผผ6 7
;
ผผ7 8
try
ฝฝ 
{
พพ 
var
ฟฟ 
authen
ฟฟ 
=
ฟฟ 
await
ฟฟ "
_jwtAuthencation
ฟฟ# 3
.
ฟฟ3 4
Autheticate
ฟฟ4 ?
(
ฟฟ? @
request
ฟฟ@ G
)
ฟฟG H
;
ฟฟH I
	svcResult
ภภ 
=
ภภ 
new
ภภ 
ServiceResult
ภภ  -
<
ภภ- .
string
ภภ. 4
>
ภภ4 5
{
มม 
Data
ยย 
=
ยย 
authen
ยย !
,
ยย! "
Success
รร 
=
รร 
true
รร "
,
รร" #
Status
ฤฤ 
=
ฤฤ !
ServiceResultStatus
ฤฤ 0
.
ฤฤ0 1
Ok
ฤฤ1 3
}
ลล 
;
ลล 
return
ฦฦ 
	svcResult
ฦฦ  
;
ฦฦ  !
}
วว 
catch
ศศ 
(
ศศ 
	Exception
ศศ 
ex
ศศ 
)
ศศ  
{
ษษ 
_logger
สส 
.
สส 
LogError
สส  
(
สส  !
$"
สส! #
{
สส# $
TAG
สส$ '
}
สส' (
$str
สส( H
{
สสH I
ex
สสI K
.
สสK L
Message
สสL S
}
สสS T
"
สสT U
)
สสU V
;
สสV W
return
หห 
	svcResult
หห  
;
หห  !
}
ฬฬ 
}
ออ 	
[
ฯฯ 	
AllowAnonymous
ฯฯ	 
]
ฯฯ 
[
ะะ 	
HttpPost
ะะ	 
(
ะะ 
$str
ะะ 
)
ะะ 
]
ะะ 
public
ัั 
async
ัั 
Task
ัั 
<
ัั 
ServiceResult
ัั '
<
ัั' (
UserRespone
ัั( 3
>
ัั3 4
>
ัั4 5
	LoginUser
ัั6 ?
(
ัั? @
[
ัั@ A
FromBody
ััA I
]
ััI J
UserRequest
ััK V
request
ััW ^
)
ัั^ _
{
าา 	
var
ำำ 
	svcResult
ำำ 
=
ำำ 
new
ำำ 
ServiceResult
ำำ  -
<
ำำ- .
UserRespone
ำำ. 9
>
ำำ9 :
(
ำำ: ;
)
ำำ; <
;
ำำ< =
try
ิิ 
{
ีี 
var
ึึ 
authen
ึึ 
=
ึึ 
await
ึึ "
_jwtAuthencation
ึึ# 3
.
ึึ3 4
Autheticate
ึึ4 ?
(
ึึ? @
request
ึึ@ G
)
ึึG H
;
ึึH I
if
ืื 
(
ืื 
authen
ืื 
.
ืื '
IsNullOrEmptyOrWhiteSpace
ืื 4
(
ืื4 5
)
ืื5 6
)
ืื6 7
{
ุุ 
	svcResult
ูู 
.
ูู 
Status
ูู $
=
ูู% &!
ServiceResultStatus
ูู' :
.
ูู: ;

Authorized
ูู; E
;
ููE F
	svcResult
ฺฺ 
.
ฺฺ 
Message
ฺฺ %
=
ฺฺ& '
$str
ฺฺ( L
;
ฺฺL M
return
 
	svcResult
 $
;
$ %
}
 
var
 
userRespone
 
=
  !
new
" %
UserRespone
& 1
(
1 2
)
2 3
;
3 4
var
฿฿ 
user
฿฿ 
=
฿฿ 
await
฿฿  
_userService
฿฿! -
.
฿฿- .$
GetUserByUserNameAsync
฿฿. D
(
฿฿D E
request
฿฿E L
.
฿฿L M
	user_name
฿฿M V
)
฿฿V W
;
฿฿W X
if
เเ 
(
เเ 
user
เเ 
==
เเ 
null
เเ  
)
เเ  !
{
แแ 
	svcResult
โโ 
.
โโ 
Message
โโ %
=
โโ& '
$str
โโ( <
;
โโ< =
return
ใใ 
	svcResult
ใใ $
;
ใใ$ %
}
ไไ 
userRespone
ๆๆ 
=
ๆๆ 
MapperExtensions
ๆๆ .
.
ๆๆ. /

MapperData
ๆๆ/ 9
<
ๆๆ9 :
User
ๆๆ: >
,
ๆๆ> ?
UserRespone
ๆๆ@ K
>
ๆๆK L
(
ๆๆL M
user
ๆๆM Q
)
ๆๆQ R
;
ๆๆR S
userRespone
็็ 
.
็็ 
key_auth
็็ $
=
็็% &
authen
็็' -
;
็็- .
	svcResult
่่ 
=
่่ 
new
่่ 
ServiceResult
่่  -
<
่่- .
UserRespone
่่. 9
>
่่9 :
{
้้ 
Data
๊๊ 
=
๊๊ 
userRespone
๊๊ &
,
๊๊& '
Success
๋๋ 
=
๋๋ 
true
๋๋ "
,
๋๋" #
Status
์์ 
=
์์ !
ServiceResultStatus
์์ 0
.
์์0 1
Ok
์์1 3
,
์์3 4
Message
ํํ 
=
ํํ 
$str
ํํ 4
}
๎๎ 
;
๎๎ 
return
๏๏ 
	svcResult
๏๏  
;
๏๏  !
}
๐๐ 
catch
๑๑ 
(
๑๑ 
	Exception
๑๑ 
ex
๑๑ 
)
๑๑  
{
๒๒ 
	svcResult
๓๓ 
.
๓๓ 
Message
๓๓ !
=
๓๓" #
$str
๓๓$ M
;
๓๓M N
_logger
๔๔ 
.
๔๔ 
LogError
๔๔  
(
๔๔  !
$"
๔๔! #
{
๔๔# $
TAG
๔๔$ '
}
๔๔' (
$str
๔๔( H
{
๔๔H I
ex
๔๔I K
.
๔๔K L
Message
๔๔L S
}
๔๔S T
"
๔๔T U
)
๔๔U V
;
๔๔V W
return
๕๕ 
	svcResult
๕๕  
;
๕๕  !
}
๖๖ 
}
๗๗ 	
[
๙๙ 	
AllowAnonymous
๙๙	 
]
๙๙ 
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
InsertStatus
( 4
>
4 5
>
5 6
RegiterUserAsync
7 G
(
G H
[
H I
FromBody
I Q
]
Q R
UserRequest
S ^
request
_ f
)
f g
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
InsertStatus
. :
>
: ;
(
; <
)
< =
;
= >
try
 
{
 
var
 
user
 
=
 
await
  
_userService
! -
.
- .$
GetUserByUserNameAsync
. D
(
D E
request
E L
.
L M
	user_name
M V
)
V W
;
W X
if
 
(
 
user
 
!=
 
null
  
)
  !
{
 
	svcResult
 
.
 
Data
 "
=
# $
InsertStatus
% 1
.
1 2
	Duplicate
2 ;
;
; <
	svcResult
 
.
 
Message
 %
=
& '
$str
( >
;
> ?
return
 
	svcResult
 $
;
$ %
}
 
var
 
resRegister
 
=
  !
await
" '
_userService
( 4
.
4 5
InsertUserAsync
5 D
(
D E
user
E I
:
I J
request
K R
)
R S
;
S T
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
InsertStatus
. :
>
: ;
{
 
Data
 
=
 
resRegister
 &
?
' (
InsertStatus
) 5
.
5 6
Success
6 =
:
> ?
InsertStatus
@ L
.
L M
Fail
M Q
,
Q R
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
,
3 4
Message
 
=
 
resRegister
 )
?
* +
$str
, @
:
A B
$str
C U
}
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
	svcResult
 
.
 
Data
 
=
  
InsertStatus
! -
.
- .
Unknow
. 4
;
4 5
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( O
{
O P
ex
P R
.
R S
Message
S Z
}
Z [
"
[ \
)
\ ]
;
] ^
	svcResult
 
.
 
Message
 !
=
" #
$str
$ M
;
M N
}
 
return
 
	svcResult
 
;
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
bool
 
>
 
	TestMinIO
  )
(
) *
)
* +
{
กก 	
var
ขข 
file
ขข 
=
ขข 
System
ขข 
.
ขข 
IO
ขข  
.
ขข  !
File
ขข! %
.
ขข% &
ReadAllBytes
ขข& 2
(
ขข2 3
$strขข3 ฅ
)ขขฅ ฆ
;ขขฆ ง
var
ฃฃ 
fullPath
ฃฃ 
=
ฃฃ 
GlobalConstant
ฃฃ )
.
ฃฃ) *!
GetFullPathTemplate
ฃฃ* =
(
ฃฃ= >
$str
ฃฃ> G
,
ฃฃG H
$str
ฃฃI W
)
ฃฃW X
;
ฃฃX Y
var
คค 
xxx
คค 
=
คค 
await
คค 
_storageClient
คค *
.
คค* +
UploadFileAsync
คค+ :
(
คค: ;
fullPath
คค; C
,
คคC D
file
คคE I
)
คคI J
;
คคJ K
return
ฅฅ 
true
ฅฅ 
;
ฅฅ 
}
ฆฆ 	
[
จจ 	
HttpGet
จจ	 
(
จจ 
$str
จจ 
)
จจ 
]
จจ 
public
ฉฉ 
async
ฉฉ 
Task
ฉฉ 
<
ฉฉ 
string
ฉฉ  
>
ฉฉ  !
GetPath
ฉฉ" )
(
ฉฉ) *
[
ฉฉ* +
	FromQuery
ฉฉ+ 4
]
ฉฉ4 5
string
ฉฉ6 <
fullPath
ฉฉ= E
)
ฉฉE F
{
ชช 	
var
ซซ 
xxx
ซซ 
=
ซซ 
await
ซซ 
_storageClient
ซซ *
.
ซซ* +&
GetPathFileDownloadAsync
ซซ+ C
(
ซซC D
fullPath
ซซD L
)
ซซL M
;
ซซM N
var
ฌฌ 
data
ฌฌ 
=
ฌฌ 
await
ฌฌ 
_storageClient
ฌฌ +
.
ฌฌ+ ,
DownloadFileAsync
ฌฌ, =
(
ฌฌ= >
fullPath
ฌฌ> F
)
ฌฌF G
;
ฌฌG H
System
ญญ 
.
ญญ 
IO
ญญ 
.
ญญ 
File
ญญ 
.
ญญ 
WriteAllBytes
ญญ (
(
ญญ( )
$str
ญญ) S
,
ญญS T
data
ญญU Y
)
ญญY Z
;
ญญZ [
return
ฎฎ 
xxx
ฎฎ 
;
ฎฎ 
}
ฏฏ 	
[
ตต 	
HttpGet
ตต	 
(
ตต 
$str
ตต (
)
ตต( )
]
ตต) *
public
ถถ 
async
ถถ 
Task
ถถ 
<
ถถ 
ServiceResult
ถถ '
<
ถถ' (
List
ถถ( ,
<
ถถ, -
AddressInfo
ถถ- 8
>
ถถ8 9
>
ถถ9 :
>
ถถ: ;"
GetAddressInfosAsync
ถถ< P
(
ถถP Q
string
ถถQ W
userId
ถถX ^
)
ถถ^ _
{
ทท 	
var
ธธ 
	svcResult
ธธ 
=
ธธ 
new
ธธ 
ServiceResult
ธธ  -
<
ธธ- .
List
ธธ. 2
<
ธธ2 3
AddressInfo
ธธ3 >
>
ธธ> ?
>
ธธ? @
(
ธธ@ A
)
ธธA B
;
ธธB C
try
นน 
{
บบ 
var
ปป 
addresInfos
ปป 
=
ปป  !
await
ปป" '!
_addressInfoService
ปป( ;
.
ปป; <
GetAddressInfos
ปป< K
(
ปปK L
userId
ปปL R
)
ปปR S
;
ปปS T
	svcResult
ผผ 
=
ผผ 
new
ผผ 
ServiceResult
ผผ  -
<
ผผ- .
List
ผผ. 2
<
ผผ2 3
AddressInfo
ผผ3 >
>
ผผ> ?
>
ผผ? @
{
ฝฝ 
Data
พพ 
=
พพ 
addresInfos
พพ &
,
พพ& '
Success
ฟฟ 
=
ฟฟ 
true
ฟฟ "
,
ฟฟ" #
Status
ภภ 
=
ภภ !
ServiceResultStatus
ภภ 0
.
ภภ0 1
Ok
ภภ1 3
}
มม 
;
มม 
return
ยย 
	svcResult
ยย  
;
ยย  !
}
รร 
catch
ฤฤ 
(
ฤฤ 
	Exception
ฤฤ 
ex
ฤฤ 
)
ฤฤ  
{
ลล 
_logger
ฦฦ 
.
ฦฦ 
LogError
ฦฦ  
(
ฦฦ  !
$"
ฦฦ! #
{
ฦฦ# $
TAG
ฦฦ$ '
}
ฦฦ' (
$str
ฦฦ( S
{
ฦฦS T
ex
ฦฦT V
.
ฦฦV W
Message
ฦฦW ^
}
ฦฦ^ _
"
ฦฦ_ `
)
ฦฦ` a
;
ฦฦa b
return
วว 
	svcResult
วว  
;
วว  !
}
ศศ 
}
ษษ 	
[
ฯฯ 	
HttpGet
ฯฯ	 
(
ฯฯ 
$str
ฯฯ #
)
ฯฯ# $
]
ฯฯ$ %
public
ะะ 
async
ะะ 
Task
ะะ 
<
ะะ 
ServiceResult
ะะ '
<
ะะ' (
AddressInfo
ะะ( 3
>
ะะ3 4
>
ะะ4 5!
GetAddressInfoAsync
ะะ6 I
(
ะะI J
string
ะะJ P
id
ะะQ S
)
ะะS T
{
ัั 	
var
าา 
	svcResult
าา 
=
าา 
new
าา 
ServiceResult
าา  -
<
าา- .
AddressInfo
าา. 9
>
าา9 :
(
าา: ;
)
าา; <
;
าา< =
try
ำำ 
{
ิิ 
var
ีี 

addresInfo
ีี 
=
ีี  
await
ีี! &!
_addressInfoService
ีี' :
.
ีี: ;
GetAddressInfo
ีี; I
(
ีีI J
id
ีีJ L
)
ีีL M
;
ีีM N
	svcResult
ึึ 
=
ึึ 
new
ึึ 
ServiceResult
ึึ  -
<
ึึ- .
AddressInfo
ึึ. 9
>
ึึ9 :
{
ืื 
Data
ุุ 
=
ุุ 

addresInfo
ุุ %
,
ุุ% &
Success
ูู 
=
ูู 
true
ูู "
,
ูู" #
Status
ฺฺ 
=
ฺฺ !
ServiceResultStatus
ฺฺ 0
.
ฺฺ0 1
Ok
ฺฺ1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
฿฿ 
_logger
เเ 
.
เเ 
LogError
เเ  
(
เเ  !
$"
เเ! #
{
เเ# $
TAG
เเ$ '
}
เเ' (
$str
เเ( R
{
เเR S
ex
เเS U
.
เเU V
Message
เเV ]
}
เเ] ^
"
เเ^ _
)
เเ_ `
;
เเ` a
return
แแ 
	svcResult
แแ  
;
แแ  !
}
โโ 
}
ใใ 	
[
้้ 	
HttpPost
้้	 
(
้้ 
$str
้้ !
)
้้! "
]
้้" #
public
๊๊ 
async
๊๊ 
Task
๊๊ 
<
๊๊ 
ServiceResult
๊๊ '
<
๊๊' (
bool
๊๊( ,
>
๊๊, -
>
๊๊- .$
InsertAddressInfoAsync
๊๊/ E
(
๊๊E F
[
๊๊F G
FromBody
๊๊G O
]
๊๊O P
AddressInfo
๊๊Q \
addressInfo
๊๊] h
)
๊๊h i
{
๋๋ 	
var
์์ 
	svcResult
์์ 
=
์์ 
new
์์ 
ServiceResult
์์  -
<
์์- .
bool
์์. 2
>
์์2 3
(
์์3 4
)
์์4 5
;
์์5 6
try
ํํ 
{
๎๎ 
var
๏๏ 
result
๏๏ 
=
๏๏ 
await
๏๏ "!
_addressInfoService
๏๏# 6
.
๏๏6 7
InsertAddressInfo
๏๏7 H
(
๏๏H I
addressInfo
๏๏I T
)
๏๏T U
;
๏๏U V
	svcResult
๐๐ 
=
๐๐ 
new
๐๐ 
ServiceResult
๐๐  -
<
๐๐- .
bool
๐๐. 2
>
๐๐2 3
{
๑๑ 
Data
๒๒ 
=
๒๒ 
result
๒๒ !
,
๒๒! "
Success
๓๓ 
=
๓๓ 
true
๓๓ "
,
๓๓" #
Status
๔๔ 
=
๔๔ !
ServiceResultStatus
๔๔ 0
.
๔๔0 1
Ok
๔๔1 3
}
๕๕ 
;
๕๕ 
return
๖๖ 
	svcResult
๖๖  
;
๖๖  !
}
๗๗ 
catch
๘๘ 
(
๘๘ 
	Exception
๘๘ 
ex
๘๘ 
)
๘๘  
{
๙๙ 
_logger
๚๚ 
.
๚๚ 
LogError
๚๚  
(
๚๚  !
$"
๚๚! #
{
๚๚# $
TAG
๚๚$ '
}
๚๚' (
$str
๚๚( U
{
๚๚U V
ex
๚๚V X
.
๚๚X Y
Message
๚๚Y `
}
๚๚` a
"
๚๚a b
)
๚๚b c
;
๚๚c d
return
๛๛ 
	svcResult
๛๛  
;
๛๛  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 !
)
! "
]
" #
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
bool
( ,
>
, -
>
- .$
UpdateAddressInfoAsync
/ E
(
E F
[
F G
FromBody
G O
]
O P
AddressInfo
Q \
addressInfo
] h
)
h i
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
(
3 4
)
4 5
;
5 6
try
 
{
 
var
 
result
 
=
 
await
 "!
_addressInfoService
# 6
.
6 7
UpdateAddressInfo
7 H
(
H I
addressInfo
I T
)
T U
;
U V
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
{
 
Data
 
=
 
result
 !
,
! "
Success
 
=
 
true
 "
,
" #
Status
 
=
 !
ServiceResultStatus
 0
.
0 1
Ok
1 3
}
 
;
 
return
 
	svcResult
  
;
  !
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( U
{
U V
ex
V X
.
X Y
Message
Y `
}
` a
"
a b
)
b c
;
c d
return
 
	svcResult
  
;
  !
}
 
}
 	
[
 	
HttpPost
	 
(
 
$str
 &
)
& '
]
' (
public
 
async
 
Task
 
<
 
ServiceResult
 '
<
' (
bool
( ,
>
, -
>
- .$
DeleteAddressInfoAsync
/ E
(
E F
string
F L
id
M O
)
O P
{
 	
var
 
	svcResult
 
=
 
new
 
ServiceResult
  -
<
- .
bool
. 2
>
2 3
(
3 4
)
4 5
;
5 6
try
กก 
{
ขข 
var
ฃฃ 
result
ฃฃ 
=
ฃฃ 
await
ฃฃ "!
_addressInfoService
ฃฃ# 6
.
ฃฃ6 7
DeleteAddressInfo
ฃฃ7 H
(
ฃฃH I
id
ฃฃI K
)
ฃฃK L
;
ฃฃL M
	svcResult
คค 
=
คค 
new
คค 
ServiceResult
คค  -
<
คค- .
bool
คค. 2
>
คค2 3
{
ฅฅ 
Data
ฆฆ 
=
ฆฆ 
result
ฆฆ !
,
ฆฆ! "
Success
งง 
=
งง 
true
งง "
,
งง" #
Status
จจ 
=
จจ !
ServiceResultStatus
จจ 0
.
จจ0 1
Ok
จจ1 3
}
ฉฉ 
;
ฉฉ 
return
ชช 
	svcResult
ชช  
;
ชช  !
}
ซซ 
catch
ฌฌ 
(
ฌฌ 
	Exception
ฌฌ 
ex
ฌฌ 
)
ฌฌ  
{
ญญ 
_logger
ฎฎ 
.
ฎฎ 
LogError
ฎฎ  
(
ฎฎ  !
$"
ฎฎ! #
{
ฎฎ# $
TAG
ฎฎ$ '
}
ฎฎ' (
$str
ฎฎ( U
{
ฎฎU V
ex
ฎฎV X
.
ฎฎX Y
Message
ฎฎY `
}
ฎฎ` a
"
ฎฎa b
)
ฎฎb c
;
ฎฎc d
return
ฏฏ 
	svcResult
ฏฏ  
;
ฏฏ  !
}
ฐฐ 
}
ฑฑ 	
[
ดด 	
HttpGet
ดด	 
(
ดด 
$str
ดด +
)
ดด+ ,
]
ดด, -
public
ตต 
async
ตต 
Task
ตต 
<
ตต 
ServiceResult
ตต '
<
ตต' (
bool
ตต( ,
>
ตต, -
>
ตต- .$
SetDefaultAddressAsync
ตต/ E
(
ตตE F
string
ตตF L
userId
ตตM S
,
ตตS T
string
ตตU [
id
ตต\ ^
,
ตต^ _
[
ตต` a
	FromQuery
ตตa j
]
ตตj k
bool
ตตl p
	isDefault
ตตq z
)
ตตz {
{
ถถ 	
var
ทท 
	svcResult
ทท 
=
ทท 
new
ทท 
ServiceResult
ทท  -
<
ทท- .
bool
ทท. 2
>
ทท2 3
(
ทท3 4
)
ทท4 5
;
ทท5 6
try
ธธ 
{
นน 
var
บบ 
result
บบ 
=
บบ 
await
บบ "!
_addressInfoService
บบ# 6
.
บบ6 7
SetDefaultAddress
บบ7 H
(
บบH I
userId
บบI O
,
บบO P
id
บบQ S
,
บบS T
	isDefault
บบU ^
)
บบ^ _
;
บบ_ `
	svcResult
ปป 
=
ปป 
new
ปป 
ServiceResult
ปป  -
<
ปป- .
bool
ปป. 2
>
ปป2 3
{
ผผ 
Data
ฝฝ 
=
ฝฝ 
result
ฝฝ !
,
ฝฝ! "
Success
พพ 
=
พพ 
true
พพ "
,
พพ" #
Status
ฟฟ 
=
ฟฟ !
ServiceResultStatus
ฟฟ 0
.
ฟฟ0 1
Ok
ฟฟ1 3
}
ภภ 
;
ภภ 
return
มม 
	svcResult
มม  
;
มม  !
}
ยย 
catch
รร 
(
รร 
	Exception
รร 
ex
รร 
)
รร  
{
ฤฤ 
_logger
ลล 
.
ลล 
LogError
ลล  
(
ลล  !
$"
ลล! #
{
ลล# $
TAG
ลล$ '
}
ลล' (
$str
ลล( U
{
ลลU V
ex
ลลV X
.
ลลX Y
Message
ลลY `
}
ลล` a
"
ลลa b
)
ลลb c
;
ลลc d
return
ฦฦ 
	svcResult
ฦฦ  
;
ฦฦ  !
}
วว 
}
ศศ 	
[
สส 	
HttpGet
สส	 
(
สส 
$str
สส *
)
สส* +
]
สส+ ,
public
หห 
async
หห 
Task
หห 
<
หห 
ServiceResult
หห '
<
หห' (
AddressInfo
หห( 3
>
หห3 4
>
หห4 5$
GetAddressDefaultAsync
หห6 L
(
หหL M
string
หหM S
userId
หหT Z
)
หหZ [
{
ฬฬ 	
var
ออ 
	svcResult
ออ 
=
ออ 
new
ออ 
ServiceResult
ออ  -
<
ออ- .
AddressInfo
ออ. 9
>
ออ9 :
(
ออ: ;
)
ออ; <
;
ออ< =
try
ฮฮ 
{
ฯฯ 
var
ะะ 
result
ะะ 
=
ะะ 
await
ะะ "!
_addressInfoService
ะะ# 6
.
ะะ6 7#
GetAddressInfoDefault
ะะ7 L
(
ะะL M
userId
ะะM S
)
ะะS T
;
ะะT U
	svcResult
ัั 
=
ัั 
new
ัั 
ServiceResult
ัั  -
<
ัั- .
AddressInfo
ัั. 9
>
ัั9 :
{
าา 
Data
ำำ 
=
ำำ 
result
ำำ !
,
ำำ! "
Success
ิิ 
=
ิิ 
true
ิิ "
,
ิิ" #
Status
ีี 
=
ีี !
ServiceResultStatus
ีี 0
.
ีี0 1
Ok
ีี1 3
}
ึึ 
;
ึึ 
return
ืื 
	svcResult
ืื  
;
ืื  !
}
ุุ 
catch
ูู 
(
ูู 
	Exception
ูู 
ex
ูู 
)
ูู  
{
ฺฺ 
_logger
 
.
 
LogError
  
(
  !
$"
! #
{
# $
TAG
$ '
}
' (
$str
( U
{
U V
ex
V X
.
X Y
Message
Y `
}
` a
"
a b
)
b c
;
c d
return
 
	svcResult
  
;
  !
}
 
}
 	
}
เเ 
}แแ ท
sC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\VideoChats\VideoChatsController.cs
	namespace 	
Web
 
. 
Api 
. 
Controllers 
{ 
[ 
ApiController 
] 
[		 
Route		 

(		
 
$str		  
)		  !
]		! "
public

 

class

  
VideoChatsController

 %
:

& '
BaseAuthController

( :
<

: ; 
VideoChatsController

; O
>

O P
{ 
	protected 
readonly 
IVideoService (
_videoService) 6
;6 7
public  
VideoChatsController #
(# $
IServiceProvider$ 4
serviceProvider5 D
)D E
:F G
baseH L
(L M
serviceProviderM \
)\ ]
{ 	
_videoService 
= 
GetRequiredService .
<. /
IVideoService/ <
>< =
(= >
)> ?
;? @
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
IActionResult 
GetToken %
(% &
)& '
=>) +
new, /

JsonResult0 :
(: ;
new; >
{? @
tokenA F
=G H
_videoServiceI V
.V W
GetTwilioJwtW c
(c d
Userd h
.h i
Identityi q
.q r
Namer v
)v w
}x y
)y z
;z {
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetRooms) 1
(1 2
)2 3
=>4 6
new7 :

JsonResult; E
(E F
awaitF K
_videoServiceL Y
.Y Z
GetAllRoomsAsyncZ j
(j k
)k l
)l m
;m n
} 
} ฒ*
sC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Controllers\WebStocket\WebSocketsController.cs
	namespace		 	
Web		
 
.		 
Api		 
.		 
Controllers		 
{

 
public 

class  
WebSocketsController %
:& '
BaseAuthController( :
<: ; 
WebSocketsController; O
>O P
{ 
public  
WebSocketsController #
(# $
IServiceProvider$ 4
serviceProvider5 D
)D E
:E F
baseF J
(J K
serviceProviderK Z
)Z [
{ 	
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
Get 
( 
) 
{ 	
if 
( 
HttpContext 
. 

WebSockets &
.& '
IsWebSocketRequest' 9
)9 :
{ 
using 
var 
	webSocket #
=$ %
await& +
HttpContext, 7
.7 8

WebSockets8 B
.B C 
AcceptWebSocketAsyncC W
(W X
)X Y
;Y Z
_logger 
. 
Log 
( 
LogLevel $
.$ %
Information% 0
,0 1
$str2 T
)T U
;U V
await 
Echo 
( 
	webSocket $
)$ %
;% &
} 
else 
{ 
HttpContext 
. 
Response $
.$ %

StatusCode% /
=0 1
$num2 5
;5 6
} 
}   	
private!! 
async!! 
Task!! 
Echo!! 
(!!  
	WebSocket!!  )
	webSocket!!* 3
)!!3 4
{"" 	
var## 
buffer## 
=## 
new## 
byte## !
[##! "
$num##" &
*##' (
$num##) *
]##* +
;##+ ,
var$$ 
result$$ 
=$$ 
await$$ 
	webSocket$$ (
.$$( )
ReceiveAsync$$) 5
($$5 6
new$$6 9
ArraySegment$$: F
<$$F G
byte$$G K
>$$K L
($$L M
buffer$$M S
)$$S T
,$$T U
CancellationToken$$V g
.$$g h
None$$h l
)$$l m
;$$m n
_logger%% 
.%% 
Log%% 
(%% 
LogLevel%%  
.%%  !
Information%%! ,
,%%, -
$str%%. L
)%%L M
;%%M N
while'' 
('' 
!'' 
result'' 
.'' 
CloseStatus'' &
.''& '
HasValue''' /
)''/ 0
{(( 
var)) 
	serverMsg)) 
=)) 
Encoding))  (
.))( )
UTF8))) -
.))- .
GetBytes)). 6
())6 7
$"))7 9
$str))9 R
{))R S
Encoding))S [
.))[ \
UTF8))\ `
.))` a
	GetString))a j
())j k
buffer))k q
)))q r
}))r s
"))s t
)))t u
;))u v
await** 
	webSocket** 
.**  
	SendAsync**  )
(**) *
new*** -
ArraySegment**. :
<**: ;
byte**; ?
>**? @
(**@ A
	serverMsg**A J
,**J K
$num**L M
,**M N
	serverMsg**O X
.**X Y
Length**Y _
)**_ `
,**` a
result**b h
.**h i
MessageType**i t
,**t u
result**v |
.**| }
EndOfMessage	**} 
,
** 
CancellationToken
** 
.
** 
None
** ก
)
**ก ข
;
**ข ฃ
_logger++ 
.++ 
Log++ 
(++ 
LogLevel++ $
.++$ %
Information++% 0
,++0 1
$str++2 J
)++J K
;++K L
result-- 
=-- 
await-- 
	webSocket-- (
.--( )
ReceiveAsync--) 5
(--5 6
new--6 9
ArraySegment--: F
<--F G
byte--G K
>--K L
(--L M
buffer--M S
)--S T
,--T U
CancellationToken--V g
.--g h
None--h l
)--l m
;--m n
_logger.. 
... 
Log.. 
(.. 
LogLevel.. $
...$ %
Information..% 0
,..0 1
$str..2 P
)..P Q
;..Q R
}00 
await11 
	webSocket11 
.11 

CloseAsync11 &
(11& '
result11' -
.11- .
CloseStatus11. 9
.119 :
Value11: ?
,11? @
result11A G
.11G H"
CloseStatusDescription11H ^
,11^ _
CancellationToken11` q
.11q r
None11r v
)11v w
;11w x
_logger22 
.22 
Log22 
(22 
LogLevel22  
.22  !
Information22! ,
,22, -
$str22. K
)22K L
;22L M
}33 	
}66 
}77 
bC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Middware\ExceptionHandling.cs
	namespace

 	
Web


 
.

 
Api

 
{ 
public 

class #
ErrorHandlingMiddleware (
{ 
private 
readonly 
RequestDelegate (
_next) .
;. /
public #
ErrorHandlingMiddleware &
(& '
RequestDelegate' 6
next7 ;
); <
{ 	
_next 
= 
next 
; 
} 	
public 
async 
Task 
Invoke  
(  !
HttpContext! ,
context- 4
)4 5
{ 	
try 
{ 
await 
_next 
( 
context #
)# $
;$ %
} 
catch 
( 
	Exception 
ex 
)  
{ 
await  
HandleExceptionAsync *
(* +
context+ 2
,2 3
ex4 6
)6 7
;7 8
} 
} 	
private   
static   
Task    
HandleExceptionAsync   0
(  0 1
HttpContext  1 <
context  = D
,  D E
	Exception  F O
	exception  P Y
)  Y Z
{!! 	
var$$ 
response$$ 
=$$ 
new$$ 
{%% 
devMsg&& 
=&& 
	exception&& "
.&&" #
Message&&# *
,&&* +
userMsg'' 
='' 
$str'' C
,''C D
Code(( 
=(( 
$str(( 
,(( 
Data)) 
=)) 
	exception))  
.))  !
Data))! %
}** 
;** 
if,, 
(,, 
	exception,, 
is,, 
ClientException,, +
),,+ ,
{-- 
response.. 
=.. 
new.. 
{// 
devMsg00 
=00 
	exception00 &
.00& '
Message00' .
,00. /
userMsg11 
=11 
	exception11 '
.11' (
Message11( /
,11/ 0
Code22 
=22 
$str22  
,22  !
Data33 
=33 
	exception33 $
.33$ %
Data33% )
}44 
;44 
context55 
.55 
Response55  
.55  !

StatusCode55! +
=55, -
$num55. 1
;551 2
}66 
else77 
{88 
response99 
=99 
new99 
{:: 
devMsg;; 
=;; 
	exception;; &
.;;& '
Message;;' .
,;;. /
userMsg<< 
=<< 
$str<< G
,<<G H
Code== 
=== 
$str==  
,==  !
Data>> 
=>> 
	exception>> $
.>>$ %
Data>>% )
}?? 
;?? 
context@@ 
.@@ 
Response@@  
.@@  !

StatusCode@@! +
=@@, -
$num@@. 1
;@@1 2
}BB 
varCC 
resultCC 
=CC 
JsonSerializerCC '
.CC' (
	SerializeCC( 1
(CC1 2
responseCC2 :
)CC: ;
;CC; <
contextDD 
.DD 
ResponseDD 
.DD 
ContentTypeDD (
=DD) *
$strDD+ =
;DD= >
returnEE 
contextEE 
.EE 
ResponseEE #
.EE# $

WriteAsyncEE$ .
(EE. /
resultEE/ 5
)EE5 6
;EE6 7
}FF 	
}GG 
}HH 
OC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Program.cs
	namespace 	
Web
 
. 
Api 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{		 	
CreateHostBuilder

 
(

 
args

 "
)

" #
.

# $
Build

$ )
(

) *
)

* +
.

+ ,
Run

, /
(

/ 0
)

0 1
;

1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. 
ConfigAppSettings "
(" #
)# $
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} น^
OC:\Users\hienv\OneDrive\Desktop\NVHIEN\DoAnTotNghiep\Backend\Web.Api\Startup.cs
	namespace 	
Web
 
. 
Api 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{   	
Configuration!! 
=!! 
configuration!! )
;!!) *
}"" 	
public## 
IConfiguration## 
Configuration## +
{##, -
get##. 1
;##1 2
}##3 4
public&& 
void&& 
ConfigureServices&& %
(&&% &
IServiceCollection&&& 8
services&&9 A
)&&A B
{'' 	
services)) 
.)) 
	Configure)) 
<)) 
PostgresSettings)) /
>))/ 0
())0 1
Configuration))1 >
.))> ?

GetSection))? I
())I J
PostgresSettings))J Z
.))Z [
CONFIG_NAME))[ f
)))f g
)))g h
;))h i
services-- 
.-- 
	Configure-- 
<-- 
GHNSettings-- *
>--* +
(--+ ,
Configuration--, 9
.--9 :

GetSection--: D
(--D E
GHNSettings--E P
.--P Q
CONFIG_NAME--Q \
)--\ ]
)--] ^
;--^ _
services.. 
... 
	Configure.. 
<.. 
QueueSettings.. ,
>.., -
(..- .
Configuration... ;
...; <

GetSection..< F
(..F G
QueueSettings..G T
...T U
CONFIG_NAME..U `
)..` a
)..a b
;..b c
services// 
.// 
	Configure// 
<// 
AppSettings// *
>//* +
(//+ ,
Configuration//, 9
.//9 :

GetSection//: D
(//D E
AppSettings//E P
.//P Q
CONFIG_NAME//Q \
)//\ ]
)//] ^
;//^ _
services00 
.00 
	Configure00 
<00 
StorageSettings00 .
>00. /
(00/ 0
Configuration000 =
.00= >

GetSection00> H
(00H I
StorageSettings00I X
.00X Y
CONFIG_NAME00Y d
)00d e
)00e f
;00f g
services22 
.22 
AddAuthentication22 &
(22& '
x22' (
=>22) +
{33 
x44 
.44 %
DefaultAuthenticateScheme44 +
=44, -
JwtBearerDefaults44. ?
.44? @ 
AuthenticationScheme44@ T
;44T U
x55 
.55 "
DefaultChallengeScheme55 (
=55) *
JwtBearerDefaults55+ <
.55< = 
AuthenticationScheme55= Q
;55Q R
}66 
)66 
.77 
AddJwtBearer77 
(77 
options77 !
=>77" $
{88 
options99 
.99  
RequireHttpsMetadata99 ,
=99- .
false99/ 4
;994 5
options:: 
.:: 
	SaveToken:: !
=::" #
true::$ (
;::( )
options;; 
.;; %
TokenValidationParameters;; 1
=;;2 3
new;;4 7%
TokenValidationParameters;;8 Q
(;;Q R
);;R S
{<< $
ValidateIssuerSigningKey== ,
===- .
true==/ 3
,==3 4
ValidateIssuer>> "
=>># $
false>>% *
,>>* +
ValidateAudience?? $
=??% &
false??' ,
,??, -
IssuerSigningKey@@ $
=@@% &
new@@' * 
SymmetricSecurityKey@@+ ?
(@@? @
Encoding@@@ H
.@@H I
ASCII@@I N
.@@N O
GetBytes@@O W
(@@W X
Configuration@@X e
[@@e f
$str@@f o
]@@o p
)@@p q
)@@q r
,@@r s
RequireSignedTokensAA '
=AA( )
trueAA* .
}BB 
;BB 
}CC 
)CC 
;CC 
servicesQQ 
.QQ 
AddTransientQQ !
<QQ! "#
IJwtAuthencationManagerQQ" 9
,QQ9 :"
JwtAuthencationManagerQQ; Q
>QQQ R
(QQR S
)QQS T
;QQT U
servicesSS 
.SS 
AddMvcSS 
(SS 
)SS 
;SS 
servicesTT 
.TT 
AddControllersTT #
(TT# $
)TT$ %
;TT% &
servicesUU 
.UU 
AddControllersUU #
(UU# $
)UU$ %
.UU% &
AddJsonOptionsUU& 4
(UU4 5
optionsUU5 <
=>UU= ?
{VV 
optionsWW 
.WW !
JsonSerializerOptionsWW -
.WW- .

ConvertersWW. 8
.WW8 9
AddWW9 <
(WW< =
newWW= @
ByteArrayConverterWWA S
(WWS T
)WWT U
)WWU V
;WWV W
}XX 
)XX 
;XX 
servicesZZ 
.ZZ &
AddStackExchangeRedisCacheZZ /
(ZZ/ 0
optionsZZ0 7
=>ZZ8 :
{[[ 
options\\ 
.\\ 
Configuration\\ %
=\\& '
Configuration\\( 5
.\\5 6

GetSection\\6 @
(\\@ A
$str\\A N
)\\N O
[\\O P
$str\\P b
]\\b c
;\\c d
}]] 
)]] 
;]] 
services^^ 
.^^ 
AddSingleton^^ !
<^^! " 
IHttpContextAccessor^^" 6
,^^6 7
HttpContextAccessor^^8 K
>^^K L
(^^L M
)^^M N
;^^N O
services__ 
.``  
AddDataInfastructure`` %
(``% &
Configuration``& 3
)``3 4
.aa 
AddAppCoreServiceaa "
(aa" #
)aa# $
.bb  
AddRedisCahedServicebb %
(bb% &
)bb& '
.cc %
AddDataServiceWebStocketscc *
(cc* +
)cc+ ,
.dd "
AddMessageQueueServicedd '
(dd' (
)dd( )
.ee &
AddStorageServiceExtensionee +
(ee+ ,
Configurationee, 9
)ee9 :
;ee: ;
serviceshh 
.hh 
AddSwaggerGenhh "
(hh" #
chh# $
=>hh% '
{ii 
cjj 
.jj 

SwaggerDocjj 
(jj 
$strjj !
,jj! "
newjj# &
OpenApiInfojj' 2
{jj3 4
Titlejj5 :
=jj; <
$strjj= F
,jjF G
VersionjjH O
=jjP Q
$strjjR V
,jjV W
DescriptionjjX c
=jjd e
$strjjf k
}jjl m
)jjm n
;jjn o
varmm 
xmlFilemm 
=mm 
$"mm  
{mm  !
Assemblymm! )
.mm) * 
GetExecutingAssemblymm* >
(mm> ?
)mm? @
.mm@ A
GetNamemmA H
(mmH I
)mmI J
.mmJ K
NamemmK O
}mmO P
$strmmP T
"mmT U
;mmU V
varnn 
xmlPathnn 
=nn 
Pathnn "
.nn" #
Combinenn# *
(nn* +

AppContextnn+ 5
.nn5 6
BaseDirectorynn6 C
,nnC D
xmlFilennE L
)nnL M
;nnM N
}oo 
)oo 
;oo 
servicespp 
.pp 
AddCorspp 
(pp 
opp 
=>pp !
opp" #
.pp# $
	AddPolicypp$ -
(pp- .
$strpp. 8
,pp8 9
builderpp: A
=>ppB D
{qq 
builderrr 
.rr 
AllowAnyOriginrr &
(rr& '
)rr' (
.ss 
AllowAnyMethodss &
(ss& '
)ss' (
.tt 
AllowAnyHeadertt &
(tt& '
)tt' (
;tt( )
}uu 
)uu 
)uu 
;uu 
}vv 	
publicyy 
voidyy 
	Configureyy 
(yy 
IApplicationBuilderyy 1
appyy2 5
,yy5 6
IWebHostEnvironmentyy7 J
envyyK N
)yyN O
{zz 	
if{{ 
({{ 
env{{ 
.{{ 
IsDevelopment{{ !
({{! "
){{" #
){{# $
{|| 
app}} 
.}} %
UseDeveloperExceptionPage}} -
(}}- .
)}}. /
;}}/ 0
}~~ 
app
 
.
 

UseSwagger
 
(
 
)
 
;
 
app
 
.
 
UseSwaggerUI
 
(
 
c
 
=>
 !
c
" #
.
# $
SwaggerEndpoint
$ 3
(
3 4
$str
4 N
,
N O
$str
P \
)
\ ]
)
] ^
;
^ _
app
 
.
 
UseMiddleware
 
(
 
typeof
 $
(
$ %%
ErrorHandlingMiddleware
% <
)
< =
)
= >
;
> ?
app
 
.
 !
UseHttpsRedirection
 #
(
# $
)
$ %
;
% &
app
 
.
 

UseRouting
 
(
 
)
 
;
 
app
 
.
 
UseAuthentication
 !
(
! "
)
" #
;
# $
app
 
.
 
UseAuthorization
  
(
  !
)
! "
;
" #
app
 
.
 
UseCors
 
(
 
$str
 "
)
" #
;
# $
app
ขข 
.
ขข 
UseEndpoints
ขข 
(
ขข 
	endpoints
ขข &
=>
ขข' )
{
ฃฃ 
	endpoints
คค 
.
คค 
MapControllers
คค (
(
คค( )
)
คค) *
;
คค* +
}
ฅฅ 
)
ฅฅ 
;
ฅฅ 
}
ฆฆ 	
public
ฐฐ 
static
ฐฐ !
IApplicationBuilder
ฐฐ )
UseSwaggerDoc
ฐฐ* 7
(
ฐฐ7 8!
IApplicationBuilder
ฐฐ8 K
app
ฐฐL O
,
ฐฐO P
string
ฐฐQ W
urlPath
ฐฐX _
)
ฐฐ_ `
{
ฑฑ 	
if
ฒฒ 
(
ฒฒ 
!
ฒฒ 
string
ฒฒ 
.
ฒฒ  
IsNullOrWhiteSpace
ฒฒ *
(
ฒฒ* +
urlPath
ฒฒ+ 2
)
ฒฒ2 3
)
ฒฒ3 4
{
ณณ 
string
ดด 
routeTemplate
ดด $
=
ดด% &
$"
ดด' )
{
ดด) *
urlPath
ดด* 1
}
ดด1 2
$str
ดด2 P
"
ดดP Q
;
ดดQ R
app
ตต 
.
ตต 

UseSwagger
ตต 
(
ตต 
c
ตต  
=>
ตต! #
{
ตต$ %
c
ตต& '
.
ตต' (
RouteTemplate
ตต( 5
=
ตต6 7
routeTemplate
ตต8 E
;
ตตE F
}
ตตG H
)
ตตH I
;
ตตI J
app
นน 
.
นน 
UseSwaggerUI
นน  
(
นน  !
c
นน! "
=>
นน# %
{
บบ 
string
ปป 
documentName
ปป '
=
ปป( )
$str
ปป* .
;
ปป. /
string
ผผ 
endPoint
ผผ #
=
ผผ$ %
$"
ผผ& (
{
ผผ( )
documentName
ผผ) 5
}
ผผ5 6
$str
ผผ6 C
"
ผผC D
;
ผผD E
c
ฝฝ 
.
ฝฝ 
SwaggerEndpoint
ฝฝ %
(
ฝฝ% &
endPoint
ฝฝ& .
,
ฝฝ. /
$str
ฝฝ0 9
)
ฝฝ9 :
;
ฝฝ: ;
c
พพ 
.
พพ 
RoutePrefix
พพ !
=
พพ" #
urlPath
พพ$ +
;
พพ+ ,
}
ฟฟ 
)
ฟฟ 
;
ฟฟ 
}
ภภ 
return
ยย 
app
ยย 
;
ยย 
}
รร 	
}
ฤฤ 
}ลล 